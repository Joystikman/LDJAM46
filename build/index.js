!function o(r,h,a){function u(i,t){if(!h[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var n=h[i]={exports:{}};r[i][0].call(n.exports,function(t){return u(r[i][1][t]||t)},n,n.exports,o,r,h,a)}return h[i].exports}for(var l="function"==typeof require&&require,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,i,e){"function"==typeof Object.create?i.exports=function(t,i){t.super_=i,t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:i.exports=function(t,i){t.super_=i;function e(){}e.prototype=i.prototype,t.prototype=new e,t.prototype.constructor=t}},{}],2:[function(t,i,e){i.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],3:[function(t,i,f){var h=/%[sdj%]/g;f.format=function(t){if(!_(t)){for(var i=[],e=0;e<arguments.length;e++)i.push(a(arguments[e]));return i.join(" ")}e=1;for(var s=arguments,n=s.length,o=String(t).replace(h,function(t){if("%%"===t)return"%";if(n<=e)return t;switch(t){case"%s":return String(s[e++]);case"%d":return Number(s[e++]);case"%j":try{return JSON.stringify(s[e++])}catch(t){return"[Circular]"}default:return t}}),r=s[e];e<n;r=s[++e])y(r)||!u(r)?o+=" "+r:o+=" "+a(r);return o},f.deprecate=function(t,i){if(w(global.process))return function(){return f.deprecate(t,i).apply(this,arguments)};if(!0===process.noDeprecation)return t;var e=!1;return function(){if(!e){if(process.throwDeprecation)throw new Error(i);process.traceDeprecation?console.trace(i):console.error(i),e=!0}return t.apply(this,arguments)}};var s,n={};function a(t,i){var e={seen:[],stylize:r};return 3<=arguments.length&&(e.depth=arguments[2]),4<=arguments.length&&(e.colors=arguments[3]),g(i)?e.showHidden=i:i&&f._extend(e,i),w(e.showHidden)&&(e.showHidden=!1),w(e.depth)&&(e.depth=2),w(e.colors)&&(e.colors=!1),w(e.customInspect)&&(e.customInspect=!0),e.colors&&(e.stylize=o),d(e,t,e.depth)}function o(t,i){var e=a.styles[i];return e?"["+a.colors[e][0]+"m"+t+"["+a.colors[e][1]+"m":t}function r(t,i){return t}function d(i,e,s){if(i.customInspect&&e&&A(e.inspect)&&e.inspect!==f.inspect&&(!e.constructor||e.constructor.prototype!==e)){var t=e.inspect(s,i);return _(t)||(t=d(i,t,s)),t}var n=function(t,i){if(w(i))return t.stylize("undefined","undefined");if(_(i)){var e="'"+JSON.stringify(i).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(e,"string")}if(x(i))return t.stylize(""+i,"number");if(g(i))return t.stylize(""+i,"boolean");if(y(i))return t.stylize("null","null")}(i,e);if(n)return n;var o,r=Object.keys(e),h=(o={},r.forEach(function(t,i){o[t]=!0}),o);if(i.showHidden&&(r=Object.getOwnPropertyNames(e)),k(e)&&(0<=r.indexOf("message")||0<=r.indexOf("description")))return $(e);if(0===r.length){if(A(e)){var a=e.name?": "+e.name:"";return i.stylize("[Function"+a+"]","special")}if(b(e))return i.stylize(RegExp.prototype.toString.call(e),"regexp");if(S(e))return i.stylize(Date.prototype.toString.call(e),"date");if(k(e))return $(e)}var u,l="",c=!1,p=["{","}"];m(e)&&(c=!0,p=["[","]"]),A(e)&&(l=" [Function"+(e.name?": "+e.name:"")+"]");return b(e)&&(l=" "+RegExp.prototype.toString.call(e)),S(e)&&(l=" "+Date.prototype.toUTCString.call(e)),k(e)&&(l=" "+$(e)),0!==r.length||c&&0!=e.length?s<0?b(e)?i.stylize(RegExp.prototype.toString.call(e),"regexp"):i.stylize("[Object]","special"):(i.seen.push(e),u=c?function(i,e,s,n,t){for(var o=[],r=0,h=e.length;r<h;++r)M(e,String(r))?o.push(v(i,e,s,n,String(r),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(v(i,e,s,n,t,!0))}),o}(i,e,s,h,r):r.map(function(t){return v(i,e,s,h,t,c)}),i.seen.pop(),function(t,i,e){if(60<t.reduce(function(t,i){return 0<=i.indexOf("\n")&&0,t+i.replace(/\u001b\[\d\d?m/g,"").length+1},0))return e[0]+(""===i?"":i+"\n ")+" "+t.join(",\n  ")+" "+e[1];return e[0]+i+" "+t.join(", ")+" "+e[1]}(u,l,p)):p[0]+l+p[1]}function $(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,i,e,s,n,o){var r,h,a;if((a=Object.getOwnPropertyDescriptor(i,n)||{value:i[n]}).get?h=a.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):a.set&&(h=t.stylize("[Setter]","special")),M(s,n)||(r="["+n+"]"),h||(t.seen.indexOf(a.value)<0?-1<(h=y(e)?d(t,a.value,null):d(t,a.value,e-1)).indexOf("\n")&&(h=o?h.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+h.split("\n").map(function(t){return"   "+t}).join("\n")):h=t.stylize("[Circular]","special")),w(r)){if(o&&n.match(/^\d+$/))return h;r=(r=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(r,"string"))}return r+": "+h}function m(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function y(t){return null===t}function x(t){return"number"==typeof t}function _(t){return"string"==typeof t}function w(t){return void 0===t}function b(t){return u(t)&&"[object RegExp]"===e(t)}function u(t){return"object"==typeof t&&null!==t}function S(t){return u(t)&&"[object Date]"===e(t)}function k(t){return u(t)&&("[object Error]"===e(t)||t instanceof Error)}function A(t){return"function"==typeof t}function e(t){return Object.prototype.toString.call(t)}function l(t){return t<10?"0"+t.toString(10):t.toString(10)}f.debuglog=function(i){if(w(s)&&(s=process.env.NODE_DEBUG||""),i=i.toUpperCase(),!n[i])if(new RegExp("\\b"+i+"\\b","i").test(s)){var e=process.pid;n[i]=function(){var t=f.format.apply(f,arguments);console.error("%s %d: %s",i,e,t)}}else n[i]=function(){};return n[i]},(f.inspect=a).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},f.isArray=m,f.isBoolean=g,f.isNull=y,f.isNullOrUndefined=function(t){return null==t},f.isNumber=x,f.isString=_,f.isSymbol=function(t){return"symbol"==typeof t},f.isUndefined=w,f.isRegExp=b,f.isObject=u,f.isDate=S,f.isError=k,f.isFunction=A,f.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},f.isBuffer=t("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function M(t,i){return Object.prototype.hasOwnProperty.call(t,i)}f.log=function(){var t,i;console.log("%s - %s",(t=new Date,i=[l(t.getHours()),l(t.getMinutes()),l(t.getSeconds())].join(":"),[t.getDate(),c[t.getMonth()],i].join(" ")),f.format.apply(f,arguments))},f.inherits=t("inherits"),f._extend=function(t,i){if(!i||!u(i))return t;for(var e=Object.keys(i),s=e.length;s--;)t[e[s]]=i[e[s]];return t}},{"./support/isBuffer":2,inherits:1}],4:[function(t,i,e){"use strict";function s(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(i.exports=s).prototype.setVolume=function(t,i){var e=this.muted;this.muted=0===t||i||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),e&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},s.prototype.setMute=function(t){this.setVolume(null,t)},s.prototype.playLoopSound=function(t,e,s,n,o,r){var h=this.audioManager,a=h.settings.defaultFade,i=h.settings.crossFading,u=this.loopSound,l=u&&u.id;if(e=Math.max(0,Math.min(1,e||1)),this.loopId=t,this.loopVol=e,!h.muted&&!this.muted){if(t===l&&u)return u.play(e*this.volume,s,n),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(u=null,!this.nextLoop||this.nextLoop.id!==t){var c=this;i?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=h.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return c.nextLoop.unload(),void(c.nextLoop=null);p(c.loopSound),d()})):(this.nextLoop=h.createSound(t,this.id),p(this.loopSound,d))}}function p(t,i){if(!t)return i&&i();t.stopping||t.stop(function(){return h.freeSound(t),t=null,i&&i()})}function f(){var i=c.loopSound=c.nextLoop;c.nextLoop=null,i&&(i.setLoop(!0,o,r),i.fade=a,i.load(function(t){if(t)return i.unload(),void(c.loopSound=null);i.play(e*c.volume,s,n)}))}function d(){c.loopSound=null,window.setTimeout(f,0)}}},{}],5:[function(t,i,e){"use strict";var s=window.AudioContext||window.webkitAudioContext,n=t("./OrderedList"),o=t("./SoundBuffered.js"),r=t("./SoundGroup.js"),h=t("./AudioChannel.js"),a=t("./ISound.js");function u(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new n(function(){return 1}),this.soundGroupArchive=new n(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,i){return t+i+".mp3"},getSoundConstructor:function(){return null}};for(var i=0;i<t.length;i++){var e=t[i];this.channels[e]=new h(e)}a.prototype.audioManager=this,r.prototype.audioManager=this,h.prototype.audioManager=this}s||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),o=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),o=a)),i.exports=u,i.exports.ISound=a,u.prototype.init=function(){if(!this.audioContext&&s)for(var t in this.audioContext=new s,o.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},u.prototype.getEmptySound=function(t,i){var e,s=this.settings.getSoundConstructor(t,i);return s?e=new s:(0<this.freeSoundPool.length?(e=this.freeSoundPool.pop()).init():e=new o,e)},u.prototype.setup=function(t){for(var i in t){var e=t[i];this.setVolume(i,e.volume,e.muted)}},u.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new h(t))},u.prototype.setVolume=function(t,i,e){var s=this.channels[t];s&&s.setVolume(i,e)},u.prototype.setMute=function(t){for(var i in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var e=this.channels[i];if(e.loopSound)if(t)e.loopSound.stop();else{var s=e.muted;e.muted=!0,e.setVolume(null,s)}}},u.prototype.loadSound=function(t,i){var e=this.createSound(t);return e.load(i),e},u.prototype.createSound=function(t,i){var e=this.getSound(t);return e||((e=this.soundsById[t]=this.getEmptySound(i,t)).setId(t),e)},u.prototype.createSoundPermanent=function(t,i){var e=this.getSound(t);if(e)return e;var s=this.settings.getSoundConstructor(i,t)||o;return(e=this.permanentSounds[t]=new s).setId(t),e},u.prototype.getSound=function(t){var i=this.permanentSounds[t];return i||((i=this.soundsById[t])?i:(i=this.soundArchiveById[t])?(this.soundArchive.removeByRef(i.poolRef),i.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=i):null)},u.prototype.getSoundGroup=function(t){var i=this.soundGroupsById[t];return i||((i=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(i.poolRef),i.poolRef=null,delete this.soundGroupArchiveById[t],i.verifySounds(),this.soundGroupsById[t]=i):null)},u.prototype.freeSound=function(t){var i=t.id;this.soundsById[i]&&delete this.soundsById[i],this.soundArchiveById[i]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[i]),t.unload(),t instanceof o&&this.freeSoundPool.push(t)},u.prototype.playLoopSound=function(t,i,e,s,n,o,r){var h=this.channels[t];if(!h)return console.warn('Channel id "'+t+'" does not exist.');h.playLoopSound(i,e,s,n,o,r)},u.prototype.stopLoopSound=function(t){var i=this,e=this.channels[t];if(!e)return console.warn('Channel id "'+t+'" does not exist.');var s=e.loopSound;e.loopId=null,s&&s.stop(function(){i.freeSound(s),e.loopSound=null})},u.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},u.prototype.release=function(){var t,i,e,s=this.settings.maxSoundGroup,n=this.settings.maxUsedMemory,o={};for(t in this.channels){var r=this.channels[t];r.loopSound&&(o[r.loopSound.id]=!0)}for(t in this.soundGroupsById)(i=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(i),this.soundGroupArchiveById[t]=i,delete this.soundGroupsById[t];for(t in this.soundsById)o[t]||((e=this.soundsById[t]).poolRef=this.soundArchive.add(e),this.soundArchiveById[t]=e,delete this.soundsById[t]);for(var h=this.soundGroupArchive.getCount();s<h&&(i=this.soundGroupArchive.popFirst());)i.poolRef=null,delete this.soundGroupArchiveById[i.id],--h;for(;this.usedMemory>n&&(e=this.soundArchive.popFirst());)e.poolRef=null,delete this.soundArchiveById[e.id],this.freeSound(e)},u.prototype.playSound=function(t,i,e,s,n){if(!this.muted){var o=this.channels[t];if(!o.muted){var r=this.getSound(i);e=e||1,(r=r||this.createSound(i,t)).play(o.volume*e,s,n)}}},u.prototype.playSoundGroup=function(t,i,e,s,n){if(!this.muted){var o=this.channels[t];if(o&&!o.muted){var r=this.getSoundGroup(i);if(!r)return console.warn('SoundGroup "'+i+'" does not exist.');e=e||1,r.play(e*o.volume,s,n)}}},u.prototype.createSoundGroup=function(t,i,e){if(!this.getSoundGroup(t)){var s=new r(t,i.id,i.vol,i.pitch,e);this.soundGroupsById[t]=s}},u.prototype.createSoundGroups=function(t,i){var e=void 0!==i&&this.channels[i].muted;for(var s in t)this.createSoundGroup(s,t[s],e)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,i,e){"use strict";function s(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(i.exports=s).prototype.setId=function(t){this.id=t,this._loaded=!1},s.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},s.prototype._finalizeLoad=function(t){var i=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var e=0;e<this._onLoadQueuedCallback.length;e++)this._onLoadQueuedCallback[e](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<i)&&this._play(),this._playTriggered=0)},s.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},s.prototype.play=function(t,i,e){if(null!=t&&this.setVolume(t),null!=i&&this.setPan(i),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(e):this._play(e)},s.prototype.init=function(){},s.prototype.setVolume=function(t){this.volume=t},s.prototype.setPan=function(t){this.pan=t},s.prototype.setLoop=function(t){this.loop=t},s.prototype.setPitch=function(t){this.pitch=t},s.prototype._updatePlayPitch=function(t){},s.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},s.prototype.stop=function(t){return this.playing=!1,t&&t()},s.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},s.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],7:[function(t,i,e){"use strict";function o(t,i,e,s){this.object=t,this.previous=i,this.next=e,this.container=s}function s(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}s.prototype.add=function(t){var i=new o(t,null,null,this);if(this.count+=1,null===this.first)return this.first=i,this.last=i;var e=this.cmpFunc(t,this.first.object);if(e<0)return i.next=this.first,this.first.previous=i,this.first=i;var s,n=this.cmpFunc(t,this.last.object);if(0<=n)return i.previous=this.last,this.last.next=i,this.last=i;if(e+n<0){for(s=this.first.next;0<=this.cmpFunc(t,s.object);)s=s.next;i.next=s,i.previous=s.previous,i.previous.next=i,s.previous=i}else{for(s=this.last.previous;this.cmpFunc(t,s.object)<0;)s=s.previous;i.previous=s,i.next=s.next,i.next.previous=i,s.next=i}return i},s.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},s.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},s.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},s.prototype.possess=function(t){return t&&t.container===this},s.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var i=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,i},s.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var i=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,i},s.prototype.getFirst=function(){return this.first&&this.first.object},s.prototype.getLast=function(){return this.last&&this.last.object},s.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},s.prototype.getCount=function(){return this.count},s.prototype.forEach=function(t,i){for(var e=this.first;e;e=e.next)t(e.object,i)},s.prototype.forEachReverse=function(t,i){for(var e=this.last;e;e=e.previous)t(e.object,i)},s.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var i=t.previous,e=t.next,s=t.object;for(null===e?this.last=i:e.previous=i,null===i?this.first=e:i.next=e;null!==i&&this.cmpFunc(s,i.object)<0;)i=(e=i).previous;for(;null!==e&&0<=this.cmpFunc(s,e.object);)e=(i=e).next;return null===(t.next=e)?this.last=t:e.previous=t,null===(t.previous=i)?this.first=t:i.next=t,t},i.exports=s},{}],8:[function(t,i,e){"use strict";var s=t("util").inherits,n=t("./ISound.js"),o={playAudioWhenScreenIsLocked:!1};function r(){n.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}s(r,n),(i.exports=r).prototype.setVolume=function(t){this.volume=this._audio.volume=t},r.prototype.setLoop=function(t){this.loop=this._audio.loop=t},r.prototype._load=function(){var i=this;function e(t){i._finalizeLoad(t)}function s(){this.removeEventListener("canplaythrough",s),this.removeEventListener("error",n),i.usedMemory=this.duration,i.audioManager.usedMemory+=this.duration,i._finalizeLoad(null)}function n(t){this.removeEventListener("canplaythrough",s),this.removeEventListener("error",n),e(t)}function o(t){i._loading=!0,i._audio.addEventListener("canplaythrough",s),i._audio.addEventListener("error",n),i._audio.src=t,i._audio.load()}var t=this.audioManager.settings.getFileUri,r=this.audioManager.settings.audioPath;if(2<t.length)t(r,this.id,function(t,i){if(t)return e(t);o(i)});else try{var h=t(r,this.id);if(!h)return e("emptyUri");o(h)}catch(t){e(t)}},r.prototype.unload=function(){n.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},r.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(o),this.playing=!0},r.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:3}],9:[function(t,i,e){"use strict";var s=t("util").inherits,n=t("./ISound.js"),o=1e-6;function r(){n.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}s(r,n),(i.exports=r).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,i=this.audioContext,e=i.createGain();t=i.createStereoPanner?i.createStereoPanner():i.createPanner(),e.connect(t),t.connect(i.destination),e.gain.value=0,this.sourceConnector=e,this.gain=e.gain,this.panNode=t,this._audioNodeReady=!0}},r.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,i=this.panNode,e=this.sourceConnector;e.disconnect(i),i.disconnect(t.destination),this.source&&(this.source.disconnect(e),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},r.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var i=this,e=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i.rawAudioData=null,i._loaded&&i._playTriggered&&((i.loop||Date.now()-i._playTriggered<e)&&i._play(),i._playTriggered=0)},function(){console.error("decode audio failed for sound ",i.id)})}},r.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=o);var i=this.audioContext.currentTime;this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||o,i),this.gain.linearRampToValueAtTime(t,i+this.fade)}else this.gain.value=t},r.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},r.prototype.setLoop=function(t,i,e){this.loop=!!t,this._loopStart=i||0,this._loopEnd=e||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},r.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},r.prototype.setPitch=function(t,i){this.pitch=t,this._setPlaybackRate(i)},r.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},r.prototype._setPlaybackRate=function(t){if(this.source){var i=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var e=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(e),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||o,e),this.source.playbackRate.linearRampToValueAtTime(i,e+t)}else this.source.playbackRate.value=i}},r.prototype._load=function(){var e=this;function s(t){e._finalizeLoad(t)}function n(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e._finalizeLoad(null)}function o(t){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status&&0!=~~i.status?s("xhrError:"+i.status):void(e.audioContext?e.audioContext.decodeAudioData(i.response,n,s):(e.rawAudioData=i.response,e._finalizeLoad(null)))},i.open("GET",t,!0),i.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,i=this.audioManager.settings.audioPath;if(2<t.length)t(i,this.id,function(t,i){if(t)return s(t);o(i)});else try{var r=t(i,this.id);if(!r)return s("emptyUri");o(r)}catch(t){s(t)}},r.prototype.unload=function(){n.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},r.prototype._play=function(t){if(this.buffer){this.playing=!0;var i=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(i),this.fade?(this.gain.setValueAtTime(this.gain.value||o,i),this.gain.linearRampToValueAtTime(this.volume||o,i+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var e=this.source=this.audioContext.createBufferSource();e.connect(this.sourceConnector);var s=this;e.onended=function(){s.playing=!1,e.onended=null,s.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),e.loop=this.loop,e.buffer=this.buffer,this._setLoopPoints(),e.start(0)}else this._playTriggered=Date.now()},r.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},r.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var i=this,e=this.audioContext.currentTime;return this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||o,e),this.gain.linearRampToValueAtTime(o,e+this.fade),void(this._fadeTimeout=window.setTimeout(function(){i._fadeTimeout=null,i._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:3}],10:[function(t,i,e){"use strict";function s(t,i,e,s,n){this.id=t,this.soundIds=i,this.volumes=e||[],this.pitches=s||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),n||this._createSounds()}(i.exports=s).prototype._createSounds=function(){for(var t=this.soundIds,i=0;i<t.length;i++)this.audioManager.loadSound(t[i]);this._ready=!0},s.prototype.play=function(t,i,e){if(0!==this.soundIds.length){this._ready||this._createSounds();var s=this.soundIds[this.soundIndex++],n=this.audioManager.getSound(s);if(!n)return console.warn("[Sound Group: "+this.id+"] sound id "+s+"  cannot be played.");t=t||1,e=e||0,t*=this.volumes[this.volIndex++],e+=this.pitches[this.pitchIndex++],n.play(t,i,e),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},s.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var i=this.soundIds[t];this.audioManager.createSound(i)}}},{}],11:[function(t,i,e){"use strict";var r=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function s(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(i.exports=s).prototype._setRGB=function(t,i,e){this.r=t,this.g=i,this.b=e},s.prototype.fromPixel=function(t,i){var e=t[i+0],s=t[i+1],n=t[i+2];return this.string="rgb("+e+","+s+","+n+")",this._setRGB(e,s,n),this},s.prototype.fromString=function(t){var i,e,s,n=(this.string=t).match(r);if(n)i=~~n[1],e=~~n[2],s=~~n[3],this._setRGB(i,e,s);else{var o="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(o>>16,o>>8&255,255&o)}return this},s.prototype.fromRGB=function(t,i,e){return this._setRGB(t,i,e),this.string="rgb("+t+","+i+","+e+")",this},s.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],12:[function(t,i,e){"use strict";var s=t("./index"),n=t("../domUtils/createCanvas"),u=~~settings.tileSize.width,l=~~settings.tileSize.height,$=Math.PI/2;s.setTileSize=function(t,i){u=~~t,l=~~i},s.prototype._init=function(){this.canvas=n(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},s.prototype.resize=function(t,i){return this.canvas.width=this.width=t,this.canvas.height=this.height=i,this.clear(),this},s.prototype.sprite=function(t,i,e,s,n,o){var r=u*(t%16),h=l*~~(t/16),a=this.ctx;return i=i||0,e=e||0,i=~~Math.round(i-this.camera.x),e=~~Math.round(e-this.camera.y),s||n||o?(a.save(),s&&(a.scale(-1,1),i=-i-u),n&&(a.scale(1,-1),e=-e-l),o?(a.translate(i+l,e),a.rotate($)):a.translate(i,e),a.drawImage(this.tilesheet,this.ox+r,this.oy+h,u,l,0,0,u,l),a.restore()):a.drawImage(this.tilesheet,this.ox+r,this.oy+h,u,l,i,e,u,l),this},s.prototype.draw=function(t,i,e,s,n,o){var r=s||n||o;if(t._isSprite){var h=t;t=h.img;var a=h.x,u=h.y,l=h.width,c=h.height,p=~~Math.round((i||0)-this.camera.x),f=~~Math.round((e||0)-this.camera.y);return r?((d=this.ctx).save(),o?(s&&(d.scale(-1,1),p*=-1,p-=c),n&&(d.scale(1,-1),f*=-1,f-=l),d.translate(p+c,f),d.rotate($)):(s&&(d.scale(-1,1),p*=-1,p-=l),n&&(d.scale(1,-1),f*=-1,f-=c),d.translate(p,f)),d.drawImage(t,a,u,l,c,0,0,l,c),d.restore(),this):(this.ctx.drawImage(t,a,u,l,c,p,f,l,c),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var d;p=~~Math.round((i||0)-this.camera.x),f=~~Math.round((e||0)-this.camera.y);return r?((d=this.ctx).save(),o?(s&&(d.scale(-1,1),p*=-1,p-=t.height),n&&(d.scale(1,-1),f*=-1,f-=t.width),d.translate(p+t.height,f),d.rotate($)):(s&&(d.scale(-1,1),p*=-1,p-=t.width),n&&(d.scale(1,-1),f*=-1,f-=t.height),d.translate(p,f)),d.drawImage(t,0,0),d.restore()):this.ctx.drawImage(t,p,f),this},s.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},s.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},s.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},s.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},s.prototype.rect=function(t,i,e,s){return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(i-this.camera.y),~~(e-1),~~(s-1)),this},s.prototype.rectf=function(t,i,e,s){return this.ctx.fillRect(~~(t-this.camera.x),~~(i-this.camera.y),~~e,~~s),this},s.prototype.rectfill=s.prototype.rectf,s.prototype._isTexture=!0,s.prototype.tilesheet=n(16*u,16*l)},{"../domUtils/createCanvas":18,"./index":13}],13:[function(t,i,e){"use strict";function s(t,i){this.width=t,this.height=i,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function n(t,i){t.ox=0,t.oy=0,i._isImageWrapper&&(i=i.asset),i._isSprite?(t.ox=i.x,t.oy=i.y,t.tilesheet=i.img):i._isMap?(i.texture||i._prepareTexture(),t.tilesheet=i.texture.canvas):i._isTexture?t.tilesheet=i.canvas:(i instanceof Image||i instanceof HTMLCanvasElement)&&(t.tilesheet=i)}(i.exports=s).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],s.prototype.ox=0,s.prototype.oy=0,s.prototype.setPalette=function(t){s.prototype.palette=t},s.prototype.setGlobalTilesheet=function(t){n(s.prototype,t)},s.prototype.setTilesheet=function(t){if(t)return n(this,t),this;delete this.tilesheet},s.prototype.setCamera=function(t,i){return this.camera.x=t||0,this.camera.y=i||0,this}},{}],14:[function(t,i,e){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s=t("./index.js"),u=3,l=5,n=s.prototype.setPalette;s.prototype.setPalette=function(t){n.call(this,t),s.prototype.textCharset=new s(128*u,l*t.length),function(t,i){for(var e=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],s=0;s<i.length;s++){t.fillStyle=i[s].string;for(var n=0;n<e.length;n++)for(var o=e[n],r=0;r<15;r++){var h=r%u,a=~~(r/u);1==(o>>r&1)&&t.fillRect(n*u+h,s*l+a,1,1)}}t.fillStyle=i[0].string}(s.prototype.textCharset.ctx,t)};var r=s.prototype.resize;s.prototype.resize=function(t,i){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(i/6),this._textPadding=i-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,r.call(this,t,i),this},s.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},s.prototype.textCharset=new s(128*u,l*s.prototype.palette.length),s.prototype.locate=function(t,i){return this._cursor.i=~~t,this._cursor.j=~~i,this},s.prototype.print=function(i,t,e){if("object"===o(i))try{i=JSON.stringify(i)}catch(t){i="[Object]"}else"string"!=typeof i&&(i=i.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),e=~~Math.round(e-this.camera.y);for(var s=0;s<i.length;s++)this.ctx.drawImage(this.textCharset.canvas,u*i.charCodeAt(s),l*this._pen,u,l,t,e,u,l),t+=4;return this}for(s=0;s<i.length;s++){this._cursor.j>=this._textLine&&this.textScroll();var n=i.charCodeAt(s);10!==n&&13!==n?(this.ctx.drawImage(this.textCharset.canvas,u*n,l*this._pen,u,l,4*this._cursor.i,6*this._cursor.j+this._textOffset,u,l),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},s.prototype.println=function(t){return this.print(t),this.print("\n"),this},s.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":13}],15:[function(t,i,e){"use strict";var s=t("../Texture"),u=~~settings.tileSize.width,l=~~settings.tileSize.height;function c(t,i,e,s,n,o,r,h){this.x=~~t,this.y=~~i,this.sprite=~~e,this.flipH=!!s,this.flipV=!!n,this.flipR=!!o,this.flagA=!!r,this.flagB=!!h}function o(t,i){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&i&&this._init(t,i)}(i.exports=o).prototype._isTileMap=!0;var h,f,n={},r=[];o.getMap=function(t){return"string"==typeof t?n[t]:"number"==typeof t?r[t]:(console.error("Map does not exist",t),null)},o._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},o.loadBank=function(t){t=o._checkBankFormat(t),n={},r=[];for(var i=t.maps||[],e=0;e<i.length;e++)r.push((new o).load(i[e]))},o.setTileSize=function(t,i){u=~~t,l=~~i},Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&n[this._name]&&n[this._name]===this&&delete n[this._name],(this._name=t)&&!n[t]&&(n[t]=this)}}),o.prototype._init=function(t,i){this.width=t,this.height=i,this.items=[];for(var e=0;e<t;e++){this.items.push([]);for(var s=0;s<i;s++)this.items[e][s]=null}this.texture&&this.texture.resize(t*u,i*l)},o.prototype.resize=function(t,i){var e=this.items,s=Math.min(this.width,t),n=Math.min(this.height,i);this._init(t,i);for(var o=0;o<s;o++)for(var r=0;r<n;r++)this.items[o][r]=e[o][r];return this.redraw(),this},o.prototype.set=function(t,i,e,s,n,o,r,h){if(null==e)return this.remove(t,i);if(!(t<0||i<0||t>=this.width||i>=this.height)){var a=this.items[t][i]=new c(t,i,e,s,n,o,r,h);return this.texture&&(this.texture.ctx.clearRect(t*u,i*l,u,l),this.texture.sprite(a.sprite,a.x*u,a.y*l,a.flipH,a.flipV,a.flipR)),this}},o.prototype.remove=function(t,i){if(!(t<0||i<0||t>=this.width||i>=this.height))return this.items[t][i]=null,this.texture&&this.texture.ctx.clearRect(t*u,i*l,u,l),this},o.prototype.get=function(t,i){return t<0||i<0||t>=this.width||i>=this.height?null:this.items[t][i]},o.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var i=0;i<this.height;i++){var e=this.items[t][i];e&&this.texture.sprite(e.sprite,e.x*u,e.y*l,e.flipH,e.flipV,e.flipR)}return this},o.prototype._prepareTexture=function(){this.texture=new s(this.width*u,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},o.prototype.release=function(){this.texture=null},o.prototype.draw=function(t,i){this.texture||this._prepareTexture(),draw(this.texture,t,i)},o.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&this.texture.setTilesheet(t),this.redraw(),this},o.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var i=t.split("/"),e=window.assets||{},s=0;s<i.length;s++)if(!(e=e[i[s]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(e)},function(){for(var e="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",u={},t=0;t<e.length;t++)u[e[t]]=t;var l=e.length,c=l*l-1,p=Math.pow(2,13),o=c-p-1;function r(t){var i=t%l;return e[~~(t/l)]+e[i]}h=function(t){for(var i="",e=0,s=0;s<t.length;s++){var n=t[s];n===t[s+1]&&++e<o||(null===n&&(n=c),i+=r(n),e===o&&e--,0!==e&&(i+=r(p+e)),e=0)}return e===o&&e--,0!==e&&(i+=r(p+e)),i},f=function(t){for(var i=[],e=0;e<t.length;){var s=t[e++],n=t[e++],o=u[s]*l+u[n];if(o===c)i.push(null);else if(p<o)for(var r=o-p,h=i[i.length-1],a=0;a<r;a++)i.push(h);else i.push(o)}return i}}(),o.prototype.save=function(){for(var t=this.width,i=this.height,e=new Array(t*i),s=0;s<t;s++)for(var n=0;n<i;n++){var o=this.items[s][n];e[s+n*t]=o?o.sprite+(o.flipH<<8)+(o.flipV<<9)+(o.flipR<<10)+(o.flagA<<11)+(o.flagB<<12):null}return{w:t,h:i,name:this.name,sheet:this._tilesheetPath||"",data:h(e)}},o.prototype.load=function(t){this.texture=null;var i=t.w,e=t.h;this._init(i,e),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var s=f(t.data),n=0;n<i;n++)for(var o=0;o<e;o++){var r=s[n+o*i];if(null!==r){var h=255&r,a=r>>8&1,u=r>>9&1,l=r>>10&1,c=r>>11&1,p=r>>12&1;this.set(n,o,h,a,u,l,c,p)}}return this},o.prototype.copy=function(t,i,e,s){t=t||0,i=i||0,null==e&&(e=this.width),null==s&&(s=this.height);var n=new o(e,s);return n.paste(this,-t,-i),n},o.prototype.paste=function(t,i,e,s){i=i||0,e=e||0;for(var n=Math.min(t.width,this.width-i),o=Math.min(t.height,this.height-e),r=Math.max(0,-i),h=Math.max(0,-e),a=r;a<n;a++)for(var u=h;u<o;u++){var l=t.items[a][u];if(l)this.set(a+i,u+e,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(s)continue;this.remove(a+i,u+e)}}return this},o.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var i=0;i<this.height;i++)this.items[t][i]=null;return this.texture&&this.texture.clear(),this},o.prototype.find=function(t,i,e){if(null===t)return this._findNull();void 0===i&&(i=null),void 0===e&&(e=null);for(var s=[],n=0;n<this.width;n++)for(var o=0;o<this.height;o++){var r=this.items[n][o];if(r){var h=null===i||r.flagA===i,a=null===e||r.flagB===e;r.sprite===t&&h&&a&&s.push(r)}}return s},o.prototype._findNull=function(){for(var t=[],i=0;i<this.width;i++)for(var e=0;e<this.height;e++)null===this.items[i][e]&&t.push({x:i,y:e});return t}},{"../Texture":13}],16:[function(t,i,e){"use strict";function f(t,i){var e=new Image;e.onload=function(){this.onload=null,this.onerror=null,i&&i(null,this)},e.onerror=function(){this.onload=null,this.onerror=null,i&&i("img:"+t)},e.src=t}function d(t,i){var e=new Audio;function s(){i&&i(null,e),e.removeEventListener("canplaythrough",s),e.removeEventListener("error",n)}function n(){i&&i("snd:load"),e.removeEventListener("canplaythrough",s),e.removeEventListener("error",n)}e.preload=!0,e.loop=!1,e.addEventListener("canplaythrough",s),e.addEventListener("error",n),e.src=t,e.load()}e.loadData=function(t,i,e){var s=new XMLHttpRequest;s.responseType=i||"arraybuffer",s.onreadystatechange=function(){if(4==~~s.readyState)return 200!=~~s.status&&0!=~~s.status?e&&e("xhrError:"+s.status):e&&e(null,s.response)},s.open("GET",t,!0),s.send()},e.loadJson=function(t,i){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status?i("xhrError:"+e.status):i&&i(null,JSON.parse(e.response))},e.open("GET",t,!0),e.send()},e.loadImage=f,e.loadSound=d,e.preloadStaticAssets=function(s,n,o){var h=s.dat,r=s.img.length,a=r+s.snd.length,u=s.root,l=0,c=0;function p(){var e,t,i=l+c;o&&o(l,i,a,i/a),t=i<r?(e=s.img[i],f):(e=s.snd[i-r],d),c+=1,t(u+e,function(t,i){t||function(t,i){var e=t.split("/"),s=e.pop().split(".");s.pop(),s=s.join(".");for(var n=h,o=0,r=e.length;o<r;o++)n=n[e[o]];n[s]=i,e.push(s),i.name=s,i.path=e.join("/")}(e,i),(l+=1)+--c<a?p():0===c&&n(null,h)})}if(0===a)return n(null,h);for(var t=Math.min(5,a-1),i=0;i<=t;i++)p()}},{}],17:[function(t,i,e){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s,n;s=window,n=function(){return s={},n.m=e=[function(t,i,e){var n=e(4);function s(){this.name="",this.speed=20,this.pmin=0,this.pmax=127,this.snap=!1,this.steps=[],this.audio=null}(t.exports=s).prototype.serialize=function(){for(var t="",i=0;i<this.steps.length;i++)t+=this.steps[i].serialize();return{n:this.name,i:[this.speed,this.pmin,this.pmax,~~this.snap],s:t}},s.prototype.deserialize=function(t){this.name=t.n,this.speed=t.i[0],this.pmin=t.i[1],this.pmax=t.i[2],this.snap=!!t.i[3],this.audio=null,this.steps=[];for(var i=t.s,e=0;e<i.length;e+=3){var s=new n;s.deserialize(i,e),this.steps.push(s)}return this},s.prototype.check=function(){11<this.name.length&&(this.name=this.name.substr(0,11)),this.speed=Math.max(0,Math.min(53,~~this.speed)),this.pmin=Math.max(0,Math.min(101,~~this.pmin)),this.pmax=Math.max(26,Math.min(127,~~this.pmax));for(var t=0;t<this.steps.length;t++)this.steps[t].check()}},function(t,i){i.SAMPLE_RATE=44100,i.CHUNK_LENGTH=50},function(t,i,e){var s=e(3),n=e(0),o=new(e(6)),r=audioManager.getEmptySound().__proto__.constructor;if(!r.prototype._createAudioNodes)throw new Error("webAudio required");function h(t){r.call(this),this._data=t}function a(t){var i=new h(t);return t.audio=i}inherits(h,r),h.prototype.load=function(t){if(this._loaded)return t&&t(null,this);t&&this._onLoadQueuedCallback.push(t),this.buffer=o.generateSound(this._data),this.usedMemory=this.buffer.duration,this.audioManager.usedMemory+=this.buffer.duration,this._finalizeLoad(null)},n.prototype.play=function(t,i,e){this.audio?this.audio.play(t,i,e):a(this).play(t,i,e)};var u=new s,l=[];i.loadProgram=function(t){u.deserialize(t),assets.bleeper={};for(var i=l.length=0;i<u.sounds.length;i++){var e=u.sounds[i],s=a(e);l.push(s);var n=e.name;n&&(assets.bleeper[n]=s,audioManager.permanentSounds[n]=s)}return u},i.sounds=l},function(t,i,e){var n=e(0);function s(){this.version=1,this.sounds=[]}(t.exports=s).prototype.serialize=function(){for(var t=[],i=0;i<this.sounds.length;i++)t.push(this.sounds[i].serialize());return{_type:"Bleeper program",v:this.version,s:t}},s.prototype.deserialize=function(t){if("Bleeper program"!==t._type)throw new Error("Incorrect data type");this.version=t.v,this.sounds.length=0;for(var i=t.s,e=0;e<i.length;e++){var s=new n;s.deserialize(i[e]),this.sounds.push(s)}return this},s.prototype.check=function(){if(0!==this.sounds.length)for(var t=0;t<this.sounds.length;t++)this.sounds[t].check();else this.sounds.push(new n)}},function(t,i,e){var n=e(5);function s(){this.wave=0,this.pitch=0,this.volume=0}(t.exports=s).prototype.serialize=function(){var t=this.wave,i=this.pitch;return 92<this.pitch&&(t+=8,i-=92),n.encodeUint6(t)+n.encodeUint6(i)+n.encodeUint6(this.volume)},s.prototype.deserialize=function(t,i){var e=n.decodeUint6(t,i),s=n.decodeUint6(t,i+1);return this.volume=n.decodeUint6(t,i+2),8<=e&&(e-=8,s+=92),this.wave=e,this.pitch=s,this},s.prototype.check=function(){this.wave=Math.max(0,Math.min(7,~~this.wave)),this.pitch=Math.max(0,Math.min(93,~~this.pitch)),this.volume=Math.max(0,Math.min(62,~~this.volume))}},function(t,i){for(var e="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",n=e.length,o={},s=0;s<e.length;s++)o[e[s]]=s;i.encodeUint13=function(t){return e[~~(t/n)]+e[t%n]},i.encodeUint6=function(t){return e[t]},i.decodeUint13=function(t,i){var e=t[i],s=t[i+1];return o[e]*n+o[s]},i.decodeUint6=function(t,i){return o[t[i]]}},function(t,i,e){var u=e(7),s=e(8),n=e(1),l=n.SAMPLE_RATE,c=n.CHUNK_LENGTH;function o(){this.oscillator=new s}(t.exports=o).prototype.generateSound=function(t){var i=t.steps;if(0===i.length)return null;var e=(t.speed+1)*c,s=i.length*e+100,n=u.createBuffer(1,s,l),o=n.getChannelData(0);this.oscillator.reset();for(var r=0,h=0;r<i.length;r++){var a=i[r];this.oscillator.setStep(t,a),this.oscillator.generate(o,h,h+e),h+=e}return this.oscillator.generateEndDamping(o,h,h+100),n}},function(t,i){var e=new window.AudioContext;t.exports=e},function(t,i,e){var s=e(9),n=e(1).SAMPLE_RATE,o=2*Math.PI,r=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];function h(){this._amp=1,this._oscPos=0,this._oscInc=0,this._oscState=1,this._oscOut=0,this._duty=0,this._prevOut=0,this.generate=this._generatePulse}(t.exports=h).prototype.reset=function(){this._oscPos=0,this._oscState=1,this._oscOut=0,this._prevOut=0},h.prototype.setStep=function(t,i){var e=t.pmin+(t.pmax-t.pmin-20)*i.pitch/93;switch(e=20+90*e/107,t.snap&&(e=Math.round(e)),this._oscInc=s.noteToFreq(e)/n,this._amp=i.volume/63,i.wave){case 0:this.generate=this._generatePulse,this._duty=.06;break;case 1:this.generate=this._generatePulse,this._duty=.12;break;case 2:this.generate=this._generatePulse,this._duty=.25;break;case 3:this.generate=this._generatePulse,this._duty=.5;break;case 4:this.generate=this._generateTriangle;break;case 5:this.generate=this._generateSine;break;case 6:this.generate=this._generateSaw,this._amp*=2;break;case 7:this.generate=this._generateNoise,this._oscInc=2.9*this._oscInc+.01}},h.prototype._generatePulse=function(t,i,e){for(var s=this._prevOut,n=i;n<e;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),s=this._oscPos>this._duty?this._amp:-this._amp,t[n]=s;this._prevOut=s},h.prototype._generateTriangle=function(t,i,e){for(var s=this._prevOut,n=i;n<e;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),s=r[~~(32*this._oscPos)]*this._amp,t[n]=s;this._prevOut=s},h.prototype._generateSine=function(t,i,e){for(var s=this._prevOut,n=i;n<e;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),s=Math.sin(this._oscPos*o)*this._amp,t[n]=s;this._prevOut=s},h.prototype._generateSaw=function(t,i,e){for(var s=this._prevOut,n=i;n<e;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),s=(this._oscPos-.5)*this._amp,t[n]=s;this._prevOut=s},h.prototype._generateNoise=function(t,i,e){for(var s=this._prevOut,n=i;n<e;n++){if(this._oscPos+=this._oscInc,1<this._oscPos){this._oscPos=this._oscPos%1;var o=!(16384&this._oscState)^!(8192&this._oscState);this._oscState=32767&(this._oscState<<1|o),this._oscOut=(16384&this._oscState)>>14}s=(this._oscOut-.5)*this._amp,t[n]=s}this._prevOut=s},h.prototype.generateEndDamping=function(t,i,e){for(var s=this._prevOut,n=i;n<e;n++)s*=.98,t[n]=s}},function(t,i){for(var n=[],e=0;e<128;e++)n.push(440*Math.pow(2,(e-69)/12));i.noteToFreqTable=n,i.noteToFreq=function(t){t<0&&(t=0),127<t&&(t=127);var i=~~t,e=t-i,s=n[i];return s+e*(n[1+i]-s)}}],n.c=s,n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(i,t){if(1&t&&(i=n(i)),8&t)return i;if(4&t&&"object"==o(i)&&i&&i.__esModule)return i;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var s in i)n.d(e,s,function(t){return i[t]}.bind(null,s));return e},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="",n(n.s=2);function n(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var e,s},"object"==(void 0===e?"undefined":o(e))&&"object"==(void 0===i?"undefined":o(i))?i.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==(void 0===e?"undefined":o(e))?e.bleeper=n():s.bleeper=n()},{}],18:[function(t,i,e){"use strict";i.exports=function(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e}},{}],19:[function(t,i,e){"use strict";var c=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],s=!(!navigator||!navigator.getGamepads),p=!1,f=.2;function n(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}n.prototype._setupButtons=function(){for(var t=0;t<c.length;t++){var i=c[t];this.btn[i]=!1,this.btnp[i]=!1,this.btnr[i]=!1}};var d=[new n,new n,new n,new n,window],o=new n;var r=s?function(){for(var t=navigator.getGamepads(),i=0;i<4;i++){var e=t[i],s=d[i];if(e){var n,o,r,h;s.available=!0,p&&(n=s.btn.right,o=s.btn.left,h=s.btn.down,r=s.btn.up);for(var a=0;a<c.length;a++){var u=c[a],l=e.buttons[a].pressed;s.btnp[u]=!s.btn[u]&&l,s.btnr[u]=s.btn[u]&&!l,s.btn[u]=l}s.x=e.axes[0],s.y=e.axes[1],s.z=e.axes[2],s.w=e.axes[3],s.lt=e.buttons[6].value,s.rt=e.buttons[7].value,p&&(s.btn.right=s.btn.right||s.x>f,s.btn.left=s.btn.left||s.x<-f,s.btn.down=s.btn.down||s.y>f,s.btn.up=s.btn.up||s.y<-f,s.btnp.right=s.btn.right&&!n,s.btnp.left=s.btn.left&&!o,s.btnp.down=s.btn.down&&!h,s.btnp.up=s.btn.up&&!r,s.btnr.right=!s.btn.right&&n,s.btnr.left=!s.btn.left&&o,s.btnr.down=!s.btn.down&&h,s.btnr.up=!s.btn.up&&r)}else s.available=!1}return d}:function(){return d};e.mapAnalogStickToDpad=function(t){p=!0,f=void 0===t?.3:t},e.update=function(){window.gamepads=r(),window.gamepad=function(){for(var t=0;t<c.length;t++){var i=c[t];o.btnp[i]=btnp[i]||d[0].btnp[i]||d[1].btnp[i]||d[2].btnp[i]||d[3].btnp[i],o.btnr[i]=btnr[i]||d[0].btnr[i]||d[1].btnr[i]||d[2].btnr[i]||d[3].btnr[i],o.btn[i]=btn[i]||d[0].btn[i]||d[1].btn[i]||d[2].btn[i]||d[3].btn[i]}return o.btn.up&&o.btn.down&&(o.btn.down=!1),o.btn.right&&o.btn.left&&(o.btn.left=!1),o}()}},{}],20:[function(t,i,e){"use strict";i.exports=function(t,i){t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],21:[function(t,i,e){"use strict";var u=null;!function n(o,r,h){function a(i,t){if(!r[i]){if(!o[i]){if(u)return u(i,!0);var e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}var s=r[i]={exports:{}};o[i][0].call(s.exports,function(t){return a(o[i][1][t]||t)},s,s.exports,n,o,r,h)}return r[i].exports}for(var u=null,t=0;t<h.length;t++)a(h[t]);return a}({1:[function(t,i,e){i.exports=function(t,i){t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],2:[function(t,i,e){function s(t){this.color=0,this.steps=[],this.frozen=!1;for(var i=0;i<t;i++){var e=new n(i);this.steps.push(e)}}var n=t("./Step"),o=(i.exports=s).prototype;o.$15=function(){for(var t=null,i=this.steps.length-1;0<=i;i--){var e=this.steps[i];if(e.$1i){var s=new n(e.index);s.note=-1,s.$1g=e.$1i,s.next=t,e.next=s}else e.next=t;e.$26||(t=e)}},o.$14=function(t){this.color=t.c||0;for(var i=t.s,e=0,s=0;s<this.steps.length;s++)e=this.steps[s].$14(i,e);this.$15()}},{"./Step":4}],3:[function(t,i,e){function s(t,i){this.album=t,this.index=i,this.name="untitled",this.author="",this.infos="",this.bpm=130,this.$k=32,this.speed=4,this.groove=[],this.highlight=16,this.loop=0,this.length=0,this.tracks=[],this.effects=[],this.$t=null;for(var e=t.trackCount,s=0;s<e;s++){var n=new o(this,s);this.tracks.push(n)}}var r=t("./Pattern"),o=t("./Track");(i.exports=s).prototype.$14=function(t){this.name=t.n||"",this.author=t.a||"",this.infos=t.i||"",this.bpm=t.b,this.$k=t.l,this.speed=t.s,this.groove=t.g,this.highlight=t.h,this.loop=t.o||0,this.$t=new r(this.$k),this.$t.frozen=!0;for(var i=t.t,e=this.length=0;e<i.length;e++){var s=this.tracks[e];s.$14(i[e]),this.length=Math.max(this.length,s.sequence.length)}var n=t.e||[];this.effects=[];for(e=0;e<4;e++){var o=n[e];o?this.effects.push({id:o.i||0,params:o.p||{}}):this.effects.push(null)}}},{"./Pattern":2,"./Track":5}],4:[function(t,i,e){function a(t,i){return l[t]*h.length+l[i]}function u(t,i,e,s){var n=a(t,i);e["fx"+s]=n%c,e["fv"+s]=~~(n/c)}function s(t,i,e,s){this.id=t,this.value=i,this.x=e,this.y=s}function n(t){this.index=t,this.$26=!0,this.next=null,this.note=null,this.inst=null,this.vol=null,this.fx1=null,this.fx2=null,this.fv1=0,this.fv2=0,this.$2n=[],this.$2o=[],this.$1g=0,this.$1i=0}var o=t("../constants").$1s,r=t("./encoding"),h=r.$1v,l=r.$25,c=r.$i,p=(i.exports=n).prototype;p.$x=function(t,i){if(t!==o.$1c)if(t!==o.$1d){var e=new s(t,i,i>>4,15&i);t===o.$2s?this.$2n.push(e):this.$2o.push(e)}else this.$1i=i/256;else this.$1g=i/256},p.$1e=function(){this.$26=!(null!==this.note||null!==this.inst||null!==this.vol||null!==this.fx1||null!==this.fx2),this.$2n=[],this.$2o=[],this.$1g=0,this.$1i=0,null!==this.fx2&&this.$x(this.fx2,this.fv2),null!==this.fx1&&this.$x(this.fx1,this.fv1)},p.$14=function(t,i){this.note=null,this.inst=null,this.vol=null,this.fx1=null,this.fx2=null;var e=l[t[i++]],s=e>>1&1,n=e>>2&1,o=e>>3&1,r=e>>4&1;if(1&e){var h=e>>5&1;this.note=h?-1:a(t[i++],t[i++])}return s&&(this.inst=l[t[i++]]),n&&(this.vol=l[t[i++]]),o&&u(t[i++],t[i++],this,1),r&&u(t[i++],t[i++],this,2),this.$1e(),i}},{"../constants":13,"./encoding":6}],5:[function(t,i,e){function s(t,i){this.index=i,this.song=t,this.synthId=0,this.patterns=[],this.sequence=[]}var o=t("./Pattern"),n=(i.exports=s).prototype;n.$2=function(t){var i=this.song.length;if(i<=t){var e=this.song.loop;t=(t-e)%(i-e)+e}if(t>this.sequence.length)return this.song.$t;var s=this.sequence[t];return-1===s?this.song.$t:this.patterns[s]},n.$js=function(){return this.song.album.instruments[this.synthId]},n.$14=function(t){this.synthId=t.y||0,this.sequence=t.s,this.patterns=[];for(var i=t.p,e=this.song.$k,s=0;s<i.length;s++){var n=new o(e);n.$14(i[s]),this.patterns.push(n)}}},{"./Pattern":2}],6:[function(t,i,e){for(var s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&'()*+,-~/:;<=>?@[]^_`{|}. !",n={},o=0;o<s.length;o++)n[s[o]]=o;e.$1v=s,e.$25=n,e.$i=32},{}],7:[function(t,i,e){function s(){this.version=0,this.trackCount=8,this.instruments={},this.songs=[],this.samples=[],this.path=""}var o=t("./Song");(i.exports=s).prototype.$14=function(t){var i=t.v||0,e=t.s||[];this.version=i,this.trackCount=t.t,this.songs=[],this.instruments=t.i,this.samples=t.a;for(var s=0;s<e.length;s++){var n=new o(this,s);n.$14(e[s]),this.songs.push(n)}}},{"./Song":3}],8:[function(t,i,e){function s(t,i){this.index=t,this.sequencer=i,this.effector=null,this.params=null,this.buffL=new Float32Array(r),this.buffR=new Float32Array(r)}var n=t("../constants"),o=t("../synths").getEffector,r=n.$h,h=(i.exports=s).prototype;h.loadEffect=function(t){if(t){this.effector=o(t.id,this.sequencer);var i=t.params;for(var e in i)this.effector[e]=i[e]}else this.effector=null},h.clearBuffer=function(){if(this.effector)for(var t=0;t<r;t++)this.buffL[t]=0,this.buffR[t]=0},h.process=function(t){this.effector&&this.effector.process(this.buffL,this.buffR,this.sequencer.buffL,this.sequencer.buffR,t)}},{"../constants":13,"../synths":27}],9:[function(t,i,e){function s(t,i){this.index=t,this.sequencer=i,this.synth=null,this.data=null,this.$u=0,this.$1w=null,this.$1f=0,this.output=this.sequencer}var n=t("../synths").getSynth,o=t("../constants").$1s,r=(i.exports=s).prototype;r.restart=function(t){this.synth&&(this.synth.$27(),this.$u=t||0,this.$1w=this.data.$2(this.$u).steps[0],this.$3())},r.loadData=function(t){this.data=t,this.synth=n(t.synthId,this.sequencer),this.output=this.sequencer,this.restart()},r.$y=function(t){if(t){null!==t.vol&&this.synth.$1q(t.vol),null!==t.inst&&this.synth.$n(this.sequencer.$j(this.index,t.inst));for(var i=0;i<t.$2n.length;i++){var e=t.$2n[i];this.synth.$2t(e.id,e.value,e.x,e.y)}null!==t.note&&(-1===t.note?this.synth.$27():this.synth.$2m(t.note));for(i=0;i<t.$2o.length;i++){(e=t.$2o[i]).id===o.$12?this.output=this.sequencer.effects[e.value]||this.sequencer:this.synth.$2t(e.id,e.value,e.x,e.y)}}},r.$3=function(){var t=this.sequencer,i=this.$1w,e=t.$w[i.index%t.$w.length];this.$1f=this.$u*t.$1y+(i.index+i.$1g)*t.$1z+e},r.$b=function(){this.$1w=this.$1w.next,this.$1w||(this.$u+=1,this.$1w=this.data.$2(this.$u).steps[0]),this.$3()},r.$1x=function(t){if(this.synth){var i=this.sequencer.t;this.$1f<=i&&(this.$y(this.$1w),this.$b());for(var e=0,s=i+t;this.$1f<s;){var n=~~(this.$1f-i);n<0&&(n=0),this.synth.$1x(this.output.buffL,this.output.buffR,e,n),e=n,this.$y(this.$1w),this.$b()}this.synth.$1x(this.output.buffL,this.output.buffR,e,t)}}},{"../constants":13,"../synths":27}],10:[function(t,i,e){function s(){this.tracks=[],this.effects=[],this.buffers=[],this.album=null,this.song=null,this.$1z=0,this.$1y=0,this.$w=[0],this.synth=null,this.t=0,this.stopped=!0,this.$1r=null,this.$16=null,this.buffL=null,this.buffR=null,this.effects.push(this);for(var t=0;t<4;t++)this.effects.push(new a(t,this));this.$4=[]}var n=t("./loadAudioBuffer"),o=t("../constants"),r=t("../audioContext"),h=t("./Track"),a=t("./Effect"),u=o.$11,l=o.$h,c=(i.exports=s).prototype;c.$e=function(){if(!this.$16){this.$1r=r.createGain(),this.$1r.connect(r.destination),this.$1r.gain.value=.5;var t=r.createScriptProcessor(l,0,2);t.onaudioprocess=this.onAudioProcess.bind(this),t.connect(this.$1r),this.$16=t}},c.onAudioProcess=function(t){var i,e=t.outputBuffer,s=this.buffL=e.getChannelData(0),n=this.buffR=e.getChannelData(1);for(i=0;i<l;i++)s[i]=0,n[i]=0;for(i=0;i<this.$4.length;i++)this.$4[i].clearBuffer();if(!this.stopped){for(i=0;i<this.tracks.length;i++)this.tracks[i].$1x(l);for(i=0;i<this.$4.length;i++)this.$4[i].process(l);this.t+=l}},c.$13=function(){for(var t=0;t<this.tracks.length;t++){var i=this.tracks[t].synth;i&&i.reset()}},c.play=function(){this.$q(0)},c.$q=function(t){if(this.song){this.t=t*this.$1y;for(var i=0;i<this.tracks.length;i++)this.tracks[i].restart(t);this.stopped=!1}},c.stop=function(){this.stopped=!0,this.$13()},c.$j=function(t,i){var e=this.song.tracks[t].synthId,s=this.album.instruments[e];return s[i%s.length]},c.loadAlbum=function(t,i){this.stop(),this.album=t,this.song=null,this.tracks=[];for(var e=t.trackCount,s=0;s<e;s++){var n=new h(s,this);this.tracks.push(n)}var o=t.samples;this.buffers=[];for(s=0;s<o.length;s++)this.buffers.push(null),this.loadAudioBufferInIndex(o[s],s)},c.loadAudioBufferInIndex=function(t,e){var s=this.buffers;n(t,function(t,i){return t?void console.error(t):void(s[e]=i.getChannelData(0))})},c.$d=function(t){if(!this.album)return console.error("No album loaded");var i=this.album.songs[t];if(!i)return console.error("No song at index");this.song=i,this.$1b();for(var e=0;e<this.tracks.length;e++){this.tracks[e].loadData(i.tracks[e])}for(e=1;e<this.effects.length;e++){this.effects[e].loadEffect(i.effects[e-1])}this.$p(),this.synth=this.tracks[0].synth,this.$13()},c.$p=function(){this.$4=[];for(var t=1;t<this.effects.length;t++){var i=this.effects[t];i.effector&&this.$4.push(i)}},c.$1b=function(){this.$1z=60*u/this.song.bpm/this.song.speed,this.$1y=this.$1z*this.song.$k,this.$v()},c.$v=function(){this.$w=[0];var t=this.song.groove;if(t&&!(t.length<2)){for(var i=0,e=0;e<t.length;e++)i+=t[e];var s=i/t.length,n=t[0];for(e=1;e<t.length;e++){var o=(n-s*e)/s*this.$1z;this.$w.push(o),n+=t[e]}}}},{"../audioContext":12,"../constants":13,"./Effect":8,"./Track":9,"./loadAudioBuffer":11}],11:[function(t,i,e){function s(t){this.uri=t,this.buffer=null,this.error=null,this.loading=!1,this.onLoad=[]}var n=t("../audioContext"),o={};s.prototype.load=function(t){return this.error||this.buffer?t(this.error,this.buffer):(this.onLoad.push(t),void(this.loading||this.initiateLoad()))},s.prototype.initiateLoad=function(){this.loading=!0;var t=new XMLHttpRequest;t.responseType="arraybuffer";var i=this;t.onreadystatechange=function(){if(4==~~t.readyState)return 200!=~~t.status&&0!=~~t.status?i.completeLoad("xhrError:"+t.status):void n.decodeAudioData(t.response,function(t){return i.completeLoad(null,t)},i.completeLoad.bind(i))},t.open("GET",this.uri,!0),t.send()},s.prototype.completeLoad=function(t,i){this.buffer=i,this.error=t;for(var e=0;e<this.onLoad.length;e++)this.onLoad[e](t,i);this.onLoad=[]},i.exports=function(t,i){var e=o[t];(e=e||(o[t]=new s(t))).load(i)}},{"../audioContext":12}],12:[function(t,i,e){var s=new window.AudioContext;i.exports=s},{}],13:[function(t,i,e){e.$h=2048,e.$11=44100,e.$r=e.$11/64,e.$1s={$1t:0,$23:1,$24:2,$2v:3,$2s:4,$8:5,$g:6,$1c:7,$1d:8,$12:9},e.$1u=1,e.$5=2,e.$9=32,e.$6=4,e.TAU=2*Math.PI},{}],14:[function(t,i,e){for(var n=[],s=0;s<128;s++)n.push((o=s,440*Math.pow(2,(o-69)/12)));var o;e.$a=n,e.$1h=function(t){t<0&&(t=0),127<t&&(t=127);var i=~~t,e=t-i,s=n[i];return s+e*(n[1+i]-s)}},{}],15:[function(t,i,e){var s=t("./audioContext"),n=t("./Album"),o=t("./Sequencer"),r=new n,h=new o;h.$e();var a={};u={context:s,output:h.$1r,loadData:function(t){r.$14(t),h.loadAlbum(r),a={};for(var i=0;i<r.songs.length;i++){var e=r.songs[i];a[e.name]=i}},playSong:function(t){a[t]&&(t=a[t]),h.$d(~~t),h.play()},stop:function(){h.stop()},$1q:function(t){h.$1r.gain.value=Math.max(0,Math.min(t,1))}}},{"./Album":7,"./Sequencer":10,"./audioContext":12}],16:[function(t,i,e){function s(){this._time=11025,this.f=.4,this.c=.6,this.$2k=new Float32Array(h),this.$21=0,this._filterState=0}var h=44100,n=(i.exports=s).prototype;s.getDefaultParams=function(){return{t:.25,f:.4,c:.6}},n.process=function(t,i,e,s,n){for(var o=0;o<n;o++){var r=this.$2k[this.$21]*this.f;this._filterState=r*this.c+this._filterState*(1-this.c),r=t[o]+this._filterState,this.$2k[(this.$21+this._time)%h]=r,this.$21+=1,this.$21>=h&&(this.$21=0),e[o]+=r,s[o]+=r}},Object.defineProperty(n,"t",{set:function(t){this._time=Math.max(100,~~(t*h))}})},{}],17:[function(t,i,e){function s(t){this.synth=t,this.$2p=0,this.$2l=d,this.$2c=0,this.out=0,this.instrument=null}function n(){this.note=0,this.volume=0,this.playing=!1,this.$2q=0,this.$m=0,this.$2w=0,this.instrument=null,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$19=!1,this.$2d=0,this.$1l=null,this.$20=0,this._damping=!1,this._dampVal=0,this._lastOut=0,this.$1j=[new s(this),new s(this),new s(this),new s(this)],this.$n(this.$1())}var o=t("../constants"),r=t("../noteUtils"),h=o.$1s,a=o.$11,u=a/60,l=(o.$1u,o.TAU),c=o.$5,p=o.$6,f=o.$9,d=0,$=s.prototype;$.$n=function(t){this.instrument=t},$.$28=function(){this.$2c=0,this.$2l=4},$.$1x=function(){switch(this.$2l){case d:return;case 2:break;case 4:this.$2c+=this.instrument.a/64,1<=this.$2c&&(this.$2c=1,this.$2l=3);break;case 3:this.$2c-=this.instrument.d/64,this.$2c<=this.instrument.s&&(this.$2c=this.instrument.s,1===this.synth.instrument.c?this.$2l=1:this.$2l=2);break;case 1:this.$2c-=this.instrument.r/64,this.$2c<=0&&(this.$2c=0,this.$2l=d,this.out=0)}var t=this.synth.$1j,i=this.instrument.c,e=0;e+=i[0]*t[0].out,e+=i[1]*t[1].out,e+=i[2]*t[2].out,e+=i[3]*t[3].out,this.$2p+=this.synth.$2q*this.instrument.m,1<=this.$2p&&(this.$2p=this.$2p%1),this.out=this.$2c*Math.sin(l*(this.$2p+e))};var v=(i.exports=n).prototype;v.$1=function(){return{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}},v.$n=function(t){this.instrument=t,this.$1j[0].$n(t.o[0]),this.$1j[1].$n(t.o[1]),this.$1j[2].$n(t.o[2]),this.$1j[3].$n(t.o[3])},v.reset=function(){this.$27(),this.$1q(15),this.$19=!1,this.$1l=null,this.$20=0,this.$2g=0,this.$2i=0,this.$17(),this.$18()},v.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/c,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.playing=!0,this.$m=0,this.$2d=0,this.$1j[0].$28(),this.$1j[1].$28(),this.$1j[2].$28(),this.$1j[3].$28(),this.$17(),this._damping=!1},v.$27=function(){this.playing&&(0===this.instrument.c?(this.$1j[0].$2l=1,this.$1j[1].$2l=1,this.$1j[2].$2l=1,this.$1j[3].$2l=1):(this.playing=!1,this._damping=!0,this._dampVal=this._lastOut))},v.$17=function(){var t=0;0<this.$2f&&(t=this.$2g*Math.sin(this.$2e*l));var i=this.note+this.instrument.p+this.$20+this.$1o+t;this.$2q=r.$1h(i)/a},v.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*l)+1)),this.$2w=this.volume*t},v.$c=function(){var t=!1,i=!1;this.$19&&(this.$2d=(this.$2d+1)%this.$1l.length,this.$20=this.$1l[this.$2d],i=!0),0!==this.$1p&&(this.$1o+=this.$1p,i=!0,(0<this.$1p&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),0<this.$2f&&(this.$2e+=this.$2f,1<this.$2e&&--this.$2e,i=!0),0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),i&&this.$17(),t&&this.$18()},v.$1q=function(t){this.volume=t/40,this.$18()},v.$2t=function(t,i,e,s){var n=!1,o=!1;switch(t){case h.$1t:this.$20=0,(this.$2d=0)===i?(this.$19=!1,n=!(this.$1l=null)):(this.$19=!0,this.$1l=0===s?[0,e]:[0,e,s]);break;case h.$24:this.$2f=e/64,this.$2g=s/16,0===s&&(n=!0);break;case h.$23:this.$2h=e/64,this.$2i=s/f,o=!0;break;case h.$2s:this.$1m=i/p;break;case h.$g:this.note+=this.$1n,this.$1o=0,this.$1n=s,this.$1p=s/(e+1)/c;break;case h.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-s,this.$1p=-s/(e+1)/c}n&&this.$17(),o&&this.$18()},v.$1x=function(t,i,e,s){if(this._damping){for(var n=e;n<s;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,i[n]+=this._dampVal,-.01<this._dampVal&&this._dampVal<.01)return void(this._damping=!1)}else if(this.playing){for(n=e;n<s;n++){if(++this.$m>=u){if(this.$m-=u,this.$1j[0].$2l===d&&this.$1j[1].$2l===d&&this.$1j[2].$2l===d&&this.$1j[3].$2l===d)return void(this.playing=!1);this.$c()}this.$1j[0].$1x(),this.$1j[1].$1x(),this.$1j[2].$1x(),this.$1j[3].$1x();var o=0;o+=this.$1j[0].instrument.v*this.$1j[0].out,o+=this.$1j[1].instrument.v*this.$1j[1].out,o+=this.$1j[2].instrument.v*this.$1j[2].out,o+=this.$1j[3].instrument.v*this.$1j[3].out,o*=this.$2w,t[n]+=o,i[n]+=o}this._lastOut=o}}},{"../constants":13,"../noteUtils":14}],18:[function(t,i,e){function s(t){this.feedback=0,this.$2k=new Float32Array(t),this._bufsize=t,this._index=0,this._filtered=0,this._damp1=0,this._damp2=0}function n(t){this.$2k=new Float32Array(t),this._bufsize=t,this._index=0}function o(){this._roomSize=0,this._roomSize1=0,this._damp=0,this._damp1=0,this._wet=0,this._wet1=0,this._wet2=0,this._dry=0,this._width=0,this.combL=[],this.combR=[],this.allpassL=[],this.allpassR=[];for(var t=0;t<8;t++)this.combL.push(new s(a[t])),this.combR.push(new s(a[t]+23));for(var i=0;i<4;i++)this.allpassL.push(new n(u[i])),this.allpassR.push(new n(u[i]+23))}var r=s.prototype;r.setDamp=function(t){this._damp1=t,this._damp2=1-t},r.mute=function(){for(var t=0;t<this._bufsize;t++)this.$2k[t]=0},r.process=function(t){var i=this.$2k[this._index];return this._filtered=i*this._damp2+this._filtered*this._damp1,this.$2k[this._index]=t+this._filtered*this.feedback,++this._index>=this._bufsize&&(this._index=0),i};var h=n.prototype;h.mute=function(){for(var t=0;t<this._bufsize;t++)this.$2k[t]=0},h.process=function(t){var i=this.$2k[this._index];return this.$2k[this._index]=t+.5*i,++this._index>=this._bufsize&&(this._index=0),i-t};var a=[1116,1188,1277,1356,1422,1491,1557,1617],u=[556,441,341,225],l=(i.exports=o).prototype;o.getDefaultParams=function(){return{d:.8,w:.3,z:.8,a:.5,i:.8}},l.process=function(t,i,e,s,n){for(var o,r=0;r<n;r++){var h=0,a=0;for(o=0;o<8;o++)h+=this.combL[o].process(t[r]),a+=this.combR[o].process(i[r]);for(o=0;o<4;o++)h=this.allpassL[o].process(h),a=this.allpassR[o].process(a);e[r]+=h*this._wet1+a*this._wet2+t[r]*this._dry,s[r]+=a*this._wet1+h*this._wet2+i[r]*this._dry}},l.mute=function(){for(var t=0;t<8;t++)this.combL[t].mute(),this.combR[t].mute();for(t=0;t<4;t++)this.allpassL[t].mute(),this.allpassR[t].mute()},l.update=function(){this._wet1=this._wet*(this._width/2+.5),this._wet2=this._wet*((1-this._width)/2),this._roomSize1=this._roomSize,this._damp1=this._damp;for(var t=0;t<8;t++)this.combL[t].feedback=this._roomSize1,this.combR[t].feedback=this._roomSize1,this.combL[t].setDamp(this._damp1),this.combR[t].setDamp(this._damp1)},Object.defineProperty(l,"d",{set:function(t){this._dry=+t}}),Object.defineProperty(l,"w",{set:function(t){this._wet=.06*t,this.update()}}),Object.defineProperty(l,"z",{set:function(t){this._roomSize=.28*t+.7,this.update()}}),Object.defineProperty(l,"a",{set:function(t){this._damp=.4*t,this.update()}}),Object.defineProperty(l,"i",{set:function(t){this._width=t,this.update()}})},{}],19:[function(t,i,e){function s(){this.note=0,this.volume=0,this.playing=!1,this.$m=0,this.$2w=1.4,this.$29=0,this.$2a=0,this.$1k=1,this.$2b=0,this.$2u=l[0],this.$2j=0,this.$2h=0,this.$2i=0,this.$1a=new o(1,15),this.$o=new o(0,1),this.$10=new o(0,1)}var n=t("../constants"),o=t("./TableEnvelope"),r=n.$1s,h=n.$11/60,a=2*Math.PI,u=[.01,.02,.04,.053,.08,.105,.15,.2,.25,.3,.35,.4,.45,.5,.7,.9],l=[8192,256,6144,4480],c=(i.exports=s).prototype;c.$1=function(){return{n:""}},c.$n=function(t){this.$1a.set(t.a),this.$o.set(t.p),this.$10.set(t.d)},c.reset=function(){this.$27(),this.$1q(15),this.$29=0,this.$2i=0,this.$17(),this.$18()},c.$2m=function(t){this.note=t,this.$m=0,this.$1a.$2r(),this.$o.$2r(),this.$10.$2r(),this.$17(),this.$18(),this.playing=!0},c.$27=function(){this.playing=!1},c.$1q=function(t){this.volume=t/30,this.$18()},c.$2t=function(t,i,e,s){var n=!1;switch(t){case r.$23:this.$2h=e/64,this.$2i=s/32,n=!0;break;case r.$2v:this.$2u=l[i%l.length]}n&&this.$18()},c.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*a)+1)),this.$2w=1.4*this.volume*t,this.$2w*=this.$1a.value},c.$17=function(){var t=~~(this.note+this.$o.value);this.$2a=u[t%16]},c.$c=function(){var t=!1,i=!1;0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),this.$1a.enabled&&this.$1a.clock()&&(t=!0),this.$o.enabled&&this.$o.clock()&&(i=!0),this.$10.enabled&&this.$10.clock()&&(this.$2u=l[~~this.$10.value%l.length]),i&&this.$17(),t&&this.$18()},c.$1x=function(t,i,e,s){if(this.playing)for(var n=e;n<s;n++){if(++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29){this.$29=this.$29%1;var o=!(16384&this.$1k)^!(this.$1k&this.$2u);this.$1k=32767&(this.$1k<<1|o),this.$2b=(16384&this.$1k)>>14}var r=(this.$2b-.5)*this.$2w;t[n]+=r,i[n]+=r}}},{"../constants":13,"./TableEnvelope":25}],20:[function(t,i,e){function s(){r.call(this),this.$2w=.25,this.$2u=.25,this.$10=new o(0,1)}for(var n=t("../constants"),o=t("./TableEnvelope"),r=t("./SimpleOscillator"),h=t("pixelbox/inherits"),a=n.$11/60,u=[1/8,.25,.5,.75],l=1;l<63;l++)u.push(l/64);h(s,r);var c=(i.exports=s).prototype;c.$n=function(t){r.prototype.$n.call(this,t),this.$10.set(t.d)},c.$2m=function(t){r.prototype.$2m.call(this,t),this.$10.$2r()},c.$1q=function(t){this.volume=t/60,this.$18()},c._updateDuty=function(t){this.$2u=u[t%u.length]},c.$c=function(){r.prototype.$c.call(this),this.$10.enabled&&this.$10.clock()&&(this.$2u=u[~~this.$10.value])},c.$1x=function(t,i,e,s){if(this.playing)for(var n=e;n<s;n++){++this.$m>=a&&(this.$m-=a,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=this.$29>this.$2u?this.$2w:-this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"./TableEnvelope":25,"pixelbox/inherits":1}],21:[function(t,i,e){function s(){n.call(this),this._damping=!1,this._dampVal=0}var n=t("./SimpleOscillator"),o=t("../constants"),r=t("pixelbox/inherits"),h=o.$11/60,a=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];r(s,n);var u=(i.exports=s).prototype;u.$2m=function(t){n.prototype.$2m.call(this,t),this._damping=!1},u.$27=function(){this.playing&&(this._damping=!0,this._dampVal=a[~~(32*this.$29)]*this.$2w),this.playing=!1},u.$1x=function(t,i,e,s){if(this._damping){for(var n=e;n<s;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,i[n]+=this._dampVal,-.01<this._dampVal&&this._dampVal<.01)return this._damping=!1,void(this.$29=0)}else if(this.playing)for(n=e;n<s;n++){++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=a[~~(32*this.$29)]*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],22:[function(t,i,e){function s(t){this._sequencer=t,this.$2k=null,this._instrument=this.$1(),this.note=0,this.volume=0,this.playing=!1,this.$21=0,this.$22=0,this.$f=0,this.$m=0,this.$2w=1,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$2l=0,this.$2c=0}var n=t("../constants"),o=t("../noteUtils"),r=(n.$1u,n.$1s),h=n.$11/60,a=o.$a[60],u=n.TAU,l=n.$5,c=n.$6,p=n.$9,f=(i.exports=s).prototype;f.$1=function(){return{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}},f.$n=function(t){var i=(this._instrument=t).a||0;this.$2k=this._sequencer.buffers[i],this.$21=t.s},f.reset=function(){this.playing=!1,this.$1q(15),this.$17(),this.$18()},f.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/l,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.$m=0,this.$21=this._instrument.s,this.$17(),this.$18(),this.$2c=0,this.$2l=4,this.$2k&&(this.playing=!0)},f.$27=function(){0===this._instrument.v[4]?this.$2l=1:this.playing=!1},f.$1q=function(t){this.volume=t/20,this.$18()},f.$2t=function(t,i,e,s){var n=!1,o=!1;switch(t){case r.$24:this.$2f=e/64,this.$2g=s/16,0===s&&(n=!0);break;case r.$23:this.$2h=e/64,this.$2i=s/p,o=!0;break;case r.$2s:this.$1m=i/c;break;case r.$g:this.note+=this.$1n,this.$1o=0,this.$1n=s,this.$1p=s/(e+1)/l;break;case r.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-s,this.$1p=-s/(e+1)/l}n&&this.$17(),o&&this.$18()},f.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=this.volume*t},f.$17=function(){var t=0;0<this.$2f&&(t=this.$2g*Math.sin(this.$2e*u));var i=this.note+this._instrument.p+this.$1o+t;this.$22=o.$1h(i)/a},f.$c=function(){var t=!1,i=!1;0!==this.$1p&&(this.$1o+=this.$1p,i=!0,(0<this.$1p&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),0<this.$2f&&(this.$2e+=this.$2f,1<this.$2e&&--this.$2e,i=!0),0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),i&&this.$17(),t&&this.$18()},f.$7=function(){if(0!==this.$2l){var t=this._instrument.v;switch(this.$2l){case 2:break;case 4:this.$2c+=t[0],1<=this.$2c&&(this.$2c=1,this.$2l=3);break;case 3:this.$2c-=t[1],this.$2c<=t[2]&&(this.$2c=t[2],1===t[4]?this.$2l=1:this.$2l=2);break;case 1:this.$2c-=t[3],this.$2c<=0&&(this.$2c=0,this.$2l=0,this.playing=!1)}}},f.$1x=function(t,i,e,s){if(this.playing)for(var n=e;n<s;n++){if(64<=++this.$f&&(this.$f=0,this.$7()),++this.$m>=h&&(this.$m-=h,this.$c()),this.$21+=this.$22,this.$21>=this._instrument.e){if(0===this._instrument.l)return void(this.playing=!1);this.$21-=this._instrument.l}var o=this.$2k[~~this.$21]*this.$2c*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"../noteUtils":14}],23:[function(t,i,e){function s(){n.call(this)}var n=t("./SimpleOscillator"),o=t("../constants"),r=t("pixelbox/inherits"),h=o.$11/60;r(s,n),(i.exports=s).prototype.$1x=function(t,i,e,s){if(this.playing)for(var n=e;n<s;n++){++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=(this.$29-.5)*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],24:[function(t,i,e){function s(){this._instrument=null,this.note=0,this.volume=0,this.playing=!1,this.$m=0,this.$2w=l,this.$29=0,this.$2a=0,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$19=!1,this.$2d=0,this.$1l=null,this.$20=0,this.$1a=new r(1,15),this.$o=new r(0,1),this.$z=new r(0,16)}var n=t("../constants"),o=t("../noteUtils"),r=t("./TableEnvelope"),h=n.$1s,a=n.$11,u=n.TAU,l=n.$1u,c=n.$5,p=n.$6,f=n.$9,d=(i.exports=s).prototype;d.$1=function(){return{n:""}},d.$n=function(t){this._instrument=t,this.$1a.set(t.a),this.$o.set(t.p),this.$z.set(t.t)},d.reset=function(){this.$27(),this.$1q(15),this.$19=!1,this.$1l=null,this.$20=0,this.$2g=0,this.$2i=0,this.$17(),this.$18()},d.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/c,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.$m=0,this.$2d=0,this.$1a.$2r(),this.$o.$2r(),this.$z.$2r(),this.$17(),this.$18(),this.playing=!0},d.$27=function(){this.playing=!1,this.$1m=null},d.$1q=function(t){this.volume=t/30,this.$18()},d.$2t=function(t,i,e,s){var n=!1,o=!1;switch(t){case h.$1t:this.$20=0,(this.$2d=0)===i?(this.$19=!1,n=!(this.$1l=null)):(this.$19=!0,this.$1l=0===s?[0,e]:[0,e,s]);break;case h.$24:this.$2f=e/64,this.$2g=s/16,0===s&&(n=!0);break;case h.$23:this.$2h=e/64,this.$2i=s/f,o=!0;break;case h.$2s:this.$1m=i/p;break;case h.$g:this.note+=this.$1n,this.$1o=0,this.$1n=s,this.$1p=s/(e+1)/c;break;case h.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-s,this.$1p=-s/(e+1)/c;break;case h.$2v:this._updateDuty(i)}n&&this.$17(),o&&this.$18()},d._updateDuty=function(t){},d.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=l*this.volume*t,this.$2w*=this.$1a.value},d.$17=function(){var t=0;0<this.$2f&&(t=this.$2g*Math.sin(this.$2e*u));var i=this.note+this.$20+this.$1o+this.$o.value+this.$z.value+t;this.$2a=o.$1h(i)/a},d.$c=function(){var t=!1,i=!1;this.$19&&(this.$2d=(this.$2d+1)%this.$1l.length,this.$20=this.$1l[this.$2d],i=!0),0!==this.$1p&&(this.$1o+=this.$1p,i=!0,(0<this.$1p&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),0<this.$2f&&(this.$2e+=this.$2f,1<this.$2e&&--this.$2e,i=!0),0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),this.$1a.enabled&&this.$1a.clock()&&(t=!0),this.$o.enabled&&this.$o.clock()&&(i=!0),this.$z.enabled&&this.$z.clock()&&(i=!0),i&&this.$17(),t&&this.$18()},d.$1x=function(t,i,e,s){}},{"../constants":13,"../noteUtils":14,"./TableEnvelope":25}],25:[function(t,i,e){function s(t,i){this._playing=!1,this._pos=0,this.min=t,this.max=i,this.data=null,this.table=null,this.enabled=!1,this.value=this.min}var n=(i.exports=s).prototype;n.set=function(t){if(!t)return this.enabled=!1,this.data=null,this.table=null,void(this.value=this.min);var i=t.t||null;this.data=t,this.enabled=i&&i.length&&!0,this.table=i,this.value=i?i[0]/this.max:this.min},n.clock=function(){return!!this._playing&&(this._pos+=1,this._pos>=this.table.length&&(0===this.data.l?(this._pos=this.table.length-1,this._playing=!1):this._pos-=this.data.l),this.value=this.table[this._pos]/this.max,!0)},n.$2r=function(){this.enabled&&(this._playing=!0,this._pos=0,this.value=this.table[0]/this.max)}},{}],26:[function(t,i,e){function s(){n.call(this),this._damping=!1,this._dampVal=0,this.$n(this.$1())}var n=t("./SimpleOscillator"),o=t("../constants"),r=t("pixelbox/inherits"),h=o.$11/60;r(s,n);var a=(i.exports=s).prototype;a.$1=function(){return{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}},a.$2m=function(t){n.prototype.$2m.call(this,t),this._damping=!1},a.$27=function(){this.playing&&(this._damping=!0,this._dampVal=this._instrument.w.t[~~(32*this.$29)]*this.$2w),this.playing=!1},a.$1q=function(t){this.volume=t/256,this.$18()},a.$1x=function(t,i,e,s){if(this._damping){for(var n=e;n<s;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,i[n]+=this._dampVal,-.01<this._dampVal&&this._dampVal<.01)return this._damping=!1,void(this.$29=0)}else if(this.playing)for(n=e;n<s;n++){++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=this._instrument.w.t[~~(32*this.$29)]*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],27:[function(t,i,e){var s=t("./NesPulse"),n=t("./NesNoise"),o=t("./NesTriangle"),r=t("./Wavetable"),h=t("./Sawtooth"),a=t("./Sampler"),u=t("./FM"),l=t("./FreeVerb"),c=t("./Delay"),p=[null,s,o,n,h,r,a,u,null,null],f=[null,l,c];e.getSynth=function(t,i){if(!t)return null;var e=p[t];return e?new e(i):null},e.getEffector=function(t,i){if(!t)return null;var e=f[t];return e?new e:null},e.$s=f},{"./Delay":16,"./FM":17,"./FreeVerb":18,"./NesNoise":19,"./NesPulse":20,"./NesTriangle":21,"./Sampler":22,"./Sawtooth":23,"./Wavetable":26}]},{},[15]),i.exports=u},{}],22:[function(t,i,e){i.exports={dat:{background_palette:null,helico:null,palette:null,sprites_palette:null,tilesheet:null,bleeper:{_type:"Bleeper program",v:1,s:[{n:"menu",i:[4,0,127,0],s:"(e8(_8(Y8(V8(Q8(L8(I8(H8(E7(C7(@8(?8(?8(?8(?7(?7(?7(?7(?7(?7(@7(B7(C7(F7(I7(K7(N7(R7(V7([7(a7(g7"},{n:"marche",i:[27,0,127,0],s:"(()((*(%,(#,(#-(#~($~(&~()~()~((~(&,(&+(%+(%+(%+(%+('+((+()+()+((*(')(&)(&)(&)(&)('*(),(+~(*-('-"},{n:"kick",i:[2,0,127,0],s:"*'3*+2*'/*#-*#+*#**#(*$&*&%*'$*%#*##*##*##*##*##*##*##*##*##*##*#$*#%*#'*#(*#)*#)*#(*#(*#)*#+)#2"},{n:"feu",i:[2,0,127,0],s:"*#U*#U*#U*#U'*U*#U*#U*#U*#U*#U*#U*%U*(U*)U**U*,U*+U*#U*#U*#U*#U',U*$U*#U',U*#U*#U*%U*/U*6U*4U*/U"},{n:"helico",i:[17,0,127,0],s:"(D:(J:(L:(H:(C:(@:(@:(A:(E:(I<(L:(L:(K:(H:(E:(A:(@:(B:(F>(I:(L:(K>(H5(E:(C>(C:(F:(I>(L:(L:(J>(?<"},{n:"helico2",i:[36,0,127,0],s:"'*~',-'~-'~-'~-'--'+-'*-'*-'--'/~'1~'1~'-~'+~'*~')~'*~'-~'0~'0~'1/'0/'-/'*/'*/'-/'//'3/'3/'1/'~/"},{n:"grab",i:[0,0,127,0],s:"(15(27(37(37(47(47(47(47(27(17(~7(,7(*7((7((7((7((7((9((7((7((9('9(&9(&:(%:(%:(%:(#:(#:(#:(#:(#:"},{n:"mer",i:[53,0,127,0],s:"'%4'&4'&4'&4'&4'&4'&4'&4'$4'#5'#6'#6''6',7'08'39'39'49'38'28'18'-8'*8'(8''8''8'%8'%8'%8'%6'%6'%6"}]},maps:{_type:"maps",maps:[{w:31,h:4,name:"arbre_ciel",sheet:"",data:"###)#,|,#(#$%p#,%o|,#,|,#(###,#(#)#*#$#,#+%p#'#(#*#&%o#)|,#*|,#7#9#7|,#8#7#8%.% |,%.#7#8#7|,#8#9#:#6#7%.%!%.#8%.|,% #9|,#:#*#G#I#G|,#H#G(h&0&1|,&0#G#H#G|,#H#I#J|,#G&0&2&0#H&0|,&1#I|,#J#*|J"},{w:31,h:4,name:"buisson",sheet:"",data:"!!|i#5#3!!|-#3#4#5!!|-#4%|!!|,#3#4#5|,#4!!|~#5!!|-#4#5!!#E#C!!|-#C#D#E!!|-#D&~!!#E#C#D#E|,#D!!|~#E!!|-#D#E!!"},{w:31,h:4,name:"sable",sheet:"",data:"!!}*#S)~&E#Z#[#T#U#V#W#X#Y#Z#[#T#U#V#W#X#Y|,#[#T#U#V#W|,#Y#Z#]+u&<"}]},patatracker:{_type:"Patatracker album",t:8,v:0,a:[],i:{1:[{n:""}],2:[{n:""}],3:[],4:[{n:"",a:{t:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],l:0}}],5:[{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}],6:[{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}],7:[{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}]},s:[{n:"title_theme",a:"joystikman",i:"",b:80,l:32,s:4,g:[],h:16,o:0,e:[0,0,0,0],t:[{y:5,p:[{s:"10Q10O10Q010M10Q10R010T10Q010O10R010Q10Q10O10M10Q010R10T010O10M10M000000",c:2}],s:[0]},{y:4,p:[{s:"00000000000000000000000000000000"}],s:[0]},{y:2,p:[{s:"10M00010O00010Q00010M00010O00010Q00000000000"}],s:[0]},{y:3,p:[{s:"00000000000000000000000000000000"}],s:[0]},{y:6,p:[{s:"00000000000000000000000000000000"}],s:[0]},{y:0,p:[],s:[]},{y:0,p:[],s:[]},{y:0,p:[],s:[]}]}]},ombres:{ombre0:null,ombre11:null,ombre12:null,ombre21:null,ombre22:null,ombre31:null,ombre32:null}},root:"assets/",img:["background_palette.png","helico.png","palette.png","sprites_palette.png","tilesheet.png","ombres/ombre0.png","ombres/ombre11.png","ombres/ombre12.png","ombres/ombre21.png","ombres/ombre22.png","ombres/ombre31.png","ombres/ombre32.png"],snd:[],settings:{name:"LDJam46",version:"2.0.0",appid:"qAzksNHAmhe3svN7",screen:{fullscreen:!1,resizable:!0,keepAspectRatio:!1,width:112,height:64,pixelSize:{width:5,height:5}},tileSize:{width:16,height:16},palette:{name:"pico8",file:"palette",colors:["#000000","#FFF1E8","#008751","#AB5236","#7E2553","#5F574F","#29ADFF","#00E756","#FFA300","#FF77A8","#C2C3C7","#83769C","#FFFF27","#FFCCAA","#1D2B53","#FF004D"]},controls:{up:38,down:40,left:37,right:39,A:32,B:88},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!0,deadZone:.5},loader:{colors:["#061626","#BCDDFC"],custom:""}}}},{}],23:[function(t,i,e){"use strict";i.exports=function(t,i){return t.x<i.x+i.w&&t.y<i.y+i.h&&i.x<t.x+t.w&&i.y<t.y+t.h}},{}],24:[function(t,i,e){"use strict";t("./viewManager"),t("./view/gameView"),t("./AABBcollision");var s=[118,119,120],n=0;function o(t){this.x=0,this.y=43,this.w=16,this.h=10,this.x=t.x,this.y=t.y,this.goRight=this.x<248?this.goRight=!0:this.goRight=!1,console.log("CREATION CRABE"),console.log(this.goRight)}o.prototype.update=function(){this.goRight?this.x+=.7:this.x-=.7},o.prototype.sprite=function(){var t=s[~~n];n=(n+.18)%3,sprite(t,this.x,this.y)},i.exports=o},{"./AABBcollision":23,"./view/gameView":29,"./viewManager":28}],25:[function(t,i,e){"use strict";t("./viewManager"),t("./view/gameView");var s=t("./AABBcollision"),n=[[64,65,66],[96,97,98],[128,129,130]],o=0,r=[50,100],h=0;function a(){this.level=0,this.life=25,this.x=256,this.y=41,this.w=16,this.h=16,this.victoire=!1,this.gameover=!1,this.etincelles=!1}a.prototype.update=function(t,i){if(this.elem_to_kill=null,this.etincelles=!1,t&&(console.log(t),s(t,this)&&(this.life+=16),console.log(this.life),this.etincelles=!0),i)for(var e=0;e<i.length;e++)s(this,i[e])&&(this.elem_to_kill=e,this.etincelles,this.life-=6);25<h&&(this.victoire=!0),this.life>r[1]?(h+=.016,this.level=2):this.life>r[0]?this.level=1:0<this.life?this.level=0:this.gameover=!0,this.life-=.025},a.prototype.sprite=function(){sprite(n[this.level][~~o],this.x,this.y,!1),o=(o+.2)%3,this.etincelles&&(sprite(144,this.x,this.y),sfx("feu"))},a.prototype.reset=function(){console.log("RESET FEU"),this.level=0,this.life=25,this.x=256,this.y=41,this.w=16,this.h=16,this.victoire=!1,this.gameover=!1,this.etincelles=!1,this.elem_to_kill=null,this.etincelles=!1,h=0},i.exports=a},{"./AABBcollision":23,"./view/gameView":29,"./viewManager":28}],26:[function(t,i,e){"use strict";var s=t("./viewManager");s.addView("menu",t("./view/menuView")),s.addView("game",t("./view/gameView")),s.open("menu"),e.update=s.update},{"./view/gameView":29,"./view/menuView":30,"./viewManager":28}],27:[function(t,i,e){"use strict";t("./viewManager"),t("./view/gameView");var n=t("./AABBcollision"),s=[67,83,84,85],o=[68,99,100,101],r=0,h=[70,71],a=0,u=[86,87],l=0,c=[102,103],p=0;function f(){this.x=0,this.y=0,this.w=16,this.h=16,this.xmin=0,this.xmax=0,this.hasBranche=!1,this.throwing=0,this.getBranche=0,this.kick=0,this.faceLeft=!1,this.marche=!1,this.stopCamera=!1,this.brancheJet=null,this.marche=!1,this.etincelles=!1,this.canMove=!0,this.frame=0,this.player_speed=1}f.prototype.update=function(t,i){if(this.brancheJet=null,this.marche=!1,this.etincelles=!1,this.canMove=!1,this.elem_to_kill={crabes:null,branches:null},0<this.throwing)this.throwing-=.24;else if(0<this.getBranche)this.getBranche-=.24;else if(0<this.kick)this.kick-=.24;else if(btn.right&&this.x<this.xmax&&(this.x+=this.player_speed,this.marche=!0,this.faceLeft=!1,this.canMove=!0),btn.left&&this.x>this.xmin&&(this.x-=this.player_speed,this.marche=!0,this.faceLeft=!0,this.canMove=!0),this.stopCamera=!1,!btnp.A||this.hasBranche){if(btnp.A&&this.hasBranche)return console.log("JET DE BRANCHE !"),this.brancheJet=this.faceLeft?{x:this.x-8,y:this.y-5,w:12,h:12}:{x:this.x+8,y:this.y-5,w:12,h:12},this.throwing=2,this.hasBranche=!1,this.marche=!1,void(this.stopCamera=!0);if(btnp.B){console.log("POSITION :"+this.x),console.log("Kick !!!"),this.stopCamera=!0,this.marche=!1,this.kick=2;for(var e=0;e<i.length;e++)console.log(e),console.log(n({x:this.x+8,y:this.y+8,w:9,h:7},{x:i[e].x,y:i[e].y+7,w:16,h:9})),this.faceLeft?n({x:this.x,y:this.y+8,w:9,h:7},{x:i[e].x,y:i[e].y+7,w:16,h:9})&&(this.elem_to_kill.crabes=e,this.etincelles=!0):n({x:this.x+8,y:this.y+8,w:9,h:7},{x:i[e].x,y:i[e].y+7,w:16,h:9})&&(this.elem_to_kill.crabes=e,this.etincelles=!0)}else;}else{console.log("PRISE DE BRANCHE !"),this.getBranche=2,this.marche=!1;for(var s=0;s<t.length;s++)n({x:this.x,y:this.y,w:16,h:16},{x:t[s].x,y:t[s].y,w:16,h:9})&&(this.elem_to_kill.branches=s,this.hasBranche=!0)}},f.prototype.sprite=function(){var t=67;this.hasBranche&&(t=68),0<this.throwing?(t=u[~~l],l=(l+.24)%3):0<this.getBranche&&(t=h[~~a],a=(a+.24)%3,sfx("grab")),0<this.kick&&(t=c[~~p],p=(p+.24)%3,sfx("kick",.8)),this.marche&&(this.hasBranche||(t=s[~~r]),this.hasBranche&&(t=o[~~r]),r=(r+.3)%3),sprite(t,this.x,this.y,this.faceLeft),this.etincelles&&(this.faceLeft&&sprite(144,this.x-8,this.y+1,this.faceLeft),this.faceLeft||sprite(144,this.x+8,this.y+1,this.faceLeft))},f.prototype.reset=function(){console.log("RESET PLAYER"),this.x=0,this.y=0,this.w=16,this.h=16,this.xmin=0,this.xmax=0,this.hasBranche=!1,this.throwing=0,this.getBranche=0,this.kick=0,this.faceLeft=!1,this.marche=!1,this.stopCamera=!1,this.brancheJet=null,this.marche=!1,this.etincelles=!1,this.canMove,this.frame=0},i.exports=f},{"./AABBcollision":23,"./view/gameView":29,"./viewManager":28}],28:[function(t,i,s){"use strict";var n={};s.view=null,s.addView=function(t,i){n[t]=i},s.open=function(t,i){var e=n[t];if(!e)return console.error("view does not exist",t);(s.view=e).open&&e.open(i)},s.update=function(){s.view.update()}},{}],29:[function(t,i,o){"use strict";var r=t("../viewManager"),e=t("../player"),s=t("../feu"),h=t("../crabe"),a=getMap("arbre_ciel"),u=getMap("sable"),l=getMap("buisson"),c=62,p=430,f=o.player=new e,d=o.feu=new s,$={x:185,y:0},v=0,m=[[160,336],[96,416],[66,430]],g=[],y=45,x=[],_=[[assets.ombres.ombre11,assets.ombres.ombre12],[assets.ombres.ombre21,assets.ombres.ombre22],[assets.ombres.ombre31,assets.ombres.ombre32]],w=0,b=assets.helico,S=-66,k=4,A=assets.ombres.ombre0,M=2;o.open=function(){console.log("OPEN"),$={x:185,y:0},v=0,g=[],x=[],S=-66,k=4,M=2,f.reset(),d.reset(),console.log(d.victoire),console.log(d.gameover),console.log(f.player_speed),f.x=240,f.y=42,f.xmin=c,f.xmax=p,paper(1).cls(),draw(a,0,0),draw(u,0,0),draw(l,0,0),d.sprite(),f.sprite(),camera($.x,$.y)},o.update=function(){if(d.victoire)console.log("GG"),paper(1).cls(),draw(a,~~v,0),draw(u,0,0),draw(l,0,0),d.sprite(),f.sprite(),g.forEach(function(t){sprite(115,t.x,t.y)}),x.forEach(function(t){t.sprite()}),camera($.x,$.y),0<k?(k-=.017,S<-5&&(S+=.35),draw(b,$.x+28,S),sfx("helico",.3)):(draw(b,$.x+28,S),sfx("helico",.3),print("You're saved !",$.x+35,$.y+25),print("->menu",$.x+27,$.y+40),(gamepad.btnp.A||gamepad.btnp.B||gamepad.btnp.start||btnp.A||btnp.B)&&(sfx("menu"),r.open("menu")));else if(d.gameover)console.log("T'AS dEAD ça"),draw(A,0,0),0<M?M-=.03:(print("... you die !",$.x+35,$.y+15),print("->retry",$.x+27,$.y+30),(gamepad.btnp.A||gamepad.btnp.B||gamepad.btnp.start||btnp.A||btnp.B)&&(sfx("menu"),r.open("game")));else{if(f.update(g,x),d.update(f.brancheJet,x),x.forEach(function(t){t.update()}),(12==random(1e5)||y)&&g.length<6){var t=m[d.level][0],i=m[d.level][1],e={x:t+random(i-t),y:43};g.push(e),y=45}if(y-=.016,12==random(100)&&x.length<3+2*d.level){console.log("CREATION CRABE");var s=0==random(2)?c:p;console.log("START :"+s);var n=o.feu=new h({x:s,y:43});x.push(n),console.log(x)}null!=f.elem_to_kill.crabes&&x.splice(f.elem_to_kill.crabes,1),null!=d.elem_to_kill&&x.splice(d.elem_to_kill,1),null!=f.elem_to_kill.branches&&g.splice(f.elem_to_kill.branches,1),btn.right&&!(0<f.throwing||0<f.getBranche||0<f.kick)&&f.canMove&&(console.log(f.canMove),$.x+=f.player_speed,v-=.15),btn.left&&!(0<f.throwing||0<f.getBranche||0<f.kick)&&f.canMove&&(console.log(f.canMove),$.x-=f.player_speed,v+=.15),paper(1).cls(),draw(a,~~v,0),draw(u,0,0),draw(l,0,0),d.sprite(),f.sprite(),g.forEach(function(t){sprite(115,t.x,t.y)}),x.forEach(function(t){t.sprite()}),camera($.x,$.y),draw(_[d.level][~~w],0,0),w=(w+.12)%2}}},{"../crabe":24,"../feu":25,"../player":27,"../viewManager":28}],30:[function(t,i,e){"use strict";var s=t("../viewManager"),n=["->PLAY"],o=[118,119,120],r=0;function h(){sfx("menu"),patatracker.stop(),s.open("game")}e.open=function(){camera(0,0),paper(1),patatracker.playSong(0)},e.update=function(){cls(),pen(10),print("Crab nightmare 🦀",27,15);var i=30;n.forEach(function(t){print(t,27,i),i+=5}),sprite(o[~~r],75,25),r=(r+.3)%3,print("@Joystikman",5,55),print("LDJam 46",80,55),gamepad.btnp.A&&h(),gamepad.btnp.B&&h(),gamepad.btnp.start&&h(),btnp.A&&h(),btnp.B&&h()}},{"../viewManager":28}],31:[function(d,t,i){"use strict";var e=d("./projectData.json");window.settings=e.settings;var s,n,o=d("./assetLoader");function r(){s.resume(),document.body.removeEventListener("mousedown",r),document.body.removeEventListener("touchstart",r)}window.inherits=d("./inherits"),window.setFullScreen=function(){},s=null,n=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return s||(s=new n,document.body.addEventListener("mousedown",r),document.body.addEventListener("touchstart",r),s)};var h=d("audio-manager"),a=window.audioManager=new h(["sfx"]);a.settings.audioPath="audio/",a.settings.defaultFade=.3,a.init(),a.setVolume("sfx",1),window.sfx=function(t,i,e,s){a.playSound("sfx",t,i,e,s)},window.music=function(t,i,e,s){t?a.playLoopSound("sfx",t,i,0,0,e,s):a.stopLoopSound("sfx")};var u=window.btn={},l=window.btnp={},c=window.btnr={},p={},f=[],$=0;function v(){for(var t=0;t<$;t++)l[f[t]]=!1,c[f[t]]=!1}function m(t,i){var e=p[t];e&&(i&&!u[e]&&(l[e]=!0),!i&&u[e]&&(c[e]=!0),u[e]=i)}!function(){var t=settings.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var i in t)p[t[i]]=i,u[i]=!1,l[i]=!1,c[i]=!1,f.push(i);$=f.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||m(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),m(t.keyCode,!1)}),window.chr$=function(t){return String.fromCharCode(t)},window.clamp=function(t,i,e){return Math.max(i,Math.min(e,t))},window.random=function(t,i){return void 0===i?~~(t*Math.random()):~~(t+Math.random()*(i-t))};var g=d("./Texture"),y=d("./TileMap");d("./Texture/canvas2D"),d("./Texture/textCanvas2D"),window.texture=function(t){var i=new g(t.width,t.height);return i.clear().draw(t,0,0),i},window.tilesheet=function(t){return g.prototype.setGlobalTilesheet(t)};var x=function(){var t=settings.screen,a=t.width,u=t.height,l=t.pixelSize,i=window.$screen=new g(a,u),e=i.canvas,s=e.style;if(document.body.appendChild(e),t.fullscreen)if(t.keepAspectRatio){var n=function(){var t=window.innerWidth,i=window.innerHeight,e=a*l.width,s=u*l.height,n=Math.min(t/e,i/s),o=e*n,r=s*n,h=$screen.canvas.style;h.width=o+"px",h.height=r+"px",h.left=(t-o)/2+"px",h.top=(i-r)/2+"px"};addEventListener("resize",n),n()}else s.width=s.height="100%";else s.width=a*l.width+"px",s.height=u*l.height+"px";return i}();window.cls=function(){return x.cls()},window.sprite=function(t,i,e,s,n,o){return x.sprite(t,i,e,s,n,o)},window.draw=function(t,i,e,s,n,o){return x.draw(t,i,e,s,n,o)},window.rect=function(t,i,e,s){return x.rect(t,i,e,s)},window.rectf=function(t,i,e,s){return x.rectf(t,i,e,s)},window.camera=function(t,i){return x.setCamera(t,i)},window.pen=function(t){return x.pen(t)},window.paper=function(t){return x.paper(t)},window.locate=function(t,i){return x.locate(t,i)},window.print=function(t,i,e){return x.print(t,i,e)},window.println=function(t){return x.println(t)},window.getMap=y.getMap,window.rectfill=window.rectf,x.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var _=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var w=~~(settings.screen.width/2),b=~~(settings.screen.width/4),S=~~(settings.screen.height/2);var k=["#000","#FFF"],A=settings.loader&&settings.loader.colors||settings.loaderColors||k;Array.isArray(A)||(A=k);var M=d("./Color");x.setPalette([(new M).fromString(A[0]),(new M).fromString(A[1])]),paper(0),cls(),paper(1),pen(1),rect(w-b-2,S-4,2*b+4,8),o.preloadStaticAssets(e,function(t,f){if(paper(0).pen(1).cls(),t)return console.error(t),void print(t);window.assets=f;var i=window.bleeper=d("./bleeper");f.bleeper&&i.loadProgram(f.bleeper);var e=window.patatracker=d("./pataTracker");f.patatracker&&e.loadData(f.patatracker),function(){var t=d("./Color"),i=settings.palette;if(i.file){for(var e=i.file.split("/"),s=f;s&&e.length;)s=s[e.shift()];if(!s)return;var n=s.width,o=s.height,r=s.x||0,h=s.y||0;s._isSprite&&(s=s.img);var a=d("./domUtils/createCanvas")(n,o).getContext("2d");a.drawImage(s,r,h,n,o,0,0,n,o);for(var u=a.getImageData(0,0,n,o).data,l=[],c=0;c<u.length;c+=4)u[c+3]<=1||l.push((new t).fromPixel(u,c));x.setPalette(l)}else{var p;for(p=i.colors?i.colors:i,l=[],c=0;c<p.length;c++)l.push((new t).fromString(p[c]));x.setPalette(l)}}(),f.tilesheet&&tilesheet(f.tilesheet),y.loadBank(f.maps);var s=d("./gamepad"),n=settings.gamepad||{};n.analogToDpad&&s.mapAnalogStickToDpad(n.deadZone);var o=d("../../src/main.js");o.update&&(v(),function t(){window.frameId+=1,s.update(),o.update(),v(),_(t)}())},function(t,i,e,s){rect(w-b-2,S-4,2*b+4,8),rectf(w-b,S-2,~~(s*b*2),4)})},{"../../src/main.js":26,"./Color":11,"./Texture":13,"./Texture/canvas2D":12,"./Texture/textCanvas2D":14,"./TileMap":15,"./assetLoader":16,"./bleeper":17,"./domUtils/createCanvas":18,"./gamepad":19,"./inherits":20,"./pataTracker":21,"./projectData.json":22,"audio-manager":5}]},{},[31]);